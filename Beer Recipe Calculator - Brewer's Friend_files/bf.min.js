// Copyright © 2012-2014 Brewer's Friend, LLC - All Rights Reserved.


var BrewingLib={};BrewingLib.e=2.718281828459045;BrewingLib.eToTheX=Math.exp;function Hops(c,j,a,b,g,e,h,f,d){this.name=c;this.type=j;this.aa=a;this.use=b;this.amount=g;this.time=e;this.ibu="";this.utilization="";this.aau="";this.units=h;this.useramount=g;this.userutilization=parseFloat(f)/100;if(this.userutilization>1){this.userutilization=1}if(this.userutilization<0){this.userutilization=0}this.usertemp=d;if(h=="g"){this.amount=gramsToOunces(this.amount)}this.aau=this.amount*this.aa}function Fermentable(b,l,k,g,f,d,e,c,j,h,a){this.name=b;this.lovibond=l;this.ppg=k;this.amount=g;this.mashable=f;this.category=d;this.lateaddition=e;this.id=c;this.group=j;this.units=h;this.useramount=g;this.domIndex=a;this.amount=convertAmountToPounds(this.amount,this.units)}function MashStep(c,f,d,e,b,a){this.temp=c;this.time=f;this.amount=d;this.type=e;this.units=b;this.domIndex=a}function calculateABV(b,a){return rounddecimal((b-a)*(125*1.05),10)}function calculateABVAlternate(d,a){var b=76.08*(d-a)/(1.775-d);var c=b*(a/0.794);return rounddecimal(c,10)}function calculateFG(m,e,c,f,b){if(!isNumber(m)){return 0}if(m<=0){return 0}if(!isNumber(e)){return 0}if(e<=0){return 0}if(b){var o=145;var q=158;var g=0;var a=0;for(var p=0;p<b.length;p++){if(b[p]==undefined||b[p].temp==undefined){continue}var l=b[p].temp;if(b[p].units!=undefined&&b[p].units!="us"){l=l*1.8+32}if(l<=q&&l>=o){if(b[p].time!=undefined&&!isNaN(b[p].time)&&b[p].time>g){g=b[p].time;a=l}else{if(g==0||b[p].time==g){var s=Math.abs(a-151);if(Math.abs(l-151)<s){a=l}}}}}if(a>=o&&a<=q){var h=a;var n=0.00001927844409*Math.pow(h,3)-0.009895553*Math.pow(h,2)+1.664019779*h-91.01523945;e=(e+0.02)*n}}var k=((m-1)*(1-e))+1;if(c){for(var p=0;p<c.length;p++){if(c[p]!=undefined&&(c[p].name.toLowerCase().indexOf("lactose")>=0||c[p].name.toLowerCase().indexOf("maltodextrin")>=0)){var d=[];d.push(c[p]);var j=calculateOG(d,100,f,true)-1;if(j<0){j=0}if(j>500){j=500}var r=j*e;k=k+r}}}return k}function calculateOG(d,e,b,a){var j=0;var c=0;var h=0;for(var f=0;f<d.length;f++){if(d[f]!=undefined){if(a||(!a&&!d[f].lateaddition)){var g=d[f].ppg*d[f].amount;if(d[f].mashable==true){c=c+g}else{j=j+g}}}}if(j>0||c>0){var g=c*(e/100);g=g+(j);h=((g/b)*0.001)+1}return h}function calculateMCUtotal(e,d){if(!isNumber(d)){return 0}if(d<=0){return 0}if(e.length==0){return 0}var a=0;for(var c=0;c<e.length;c++){if(e[c]!=undefined){var b=calculateMCU(e[c],d);a=a+b}}return a}function calculateMCU(a,b){if(!isNumber(b)){return 0}if(b<=0){return 0}if(!a){return 0}return a.lovibond*(a.amount/b)}function calculateSRMMorey(c,b){if(!isNumber(b)){return 0}if(b<=0){return 0}if(c.length==0){return 0}var d=0;var a=calculateMCUtotal(c,b);d=1.4922*Math.pow(a,0.6859);if(d>=50){d=50}return d}function calculateSRMDaniels(c,b){if(!isNumber(b)){return 0}if(b<=0){return 0}if(c.length==0){return 0}var d=0;var a=calculateMCUtotal(c,b);d=(a*0.2)+8.4;if(d>=40){d=40}return d}function calculateSRMMosher(c,b){if(!isNumber(b)){return 0}if(b<=0){return 0}if(c.length==0){return 0}var d=0;var a=calculateMCUtotal(c,b);d=(a*0.3)+4.7;if(d>=40){d=40}return d}function srmToECB(a){return 1.97*a}function calculateBoilGravity(b,a,c){if(!isNumber(b)){return 0}if(!isNumber(a)){return 0}if(!isNumber(c)){return 0}if(a<=0){return 0}if(c<=0){return 0}if(b<=0){return 0}return((b/a)*(c-1)+1)}function getTotalAmount(c){var b=0;for(var a=0;a<c.length;a++){if(c[a]!=undefined&&c[a].amount>0){b=b+parseFloat(c[a].amount)}}return b}function getIBUTotal(a){var b=0;for(var c=0;c<a.length;c++){if(a[c]!=""){if(parseFloat(a[c].ibu)>0){b=b+a[c].ibu}}}return b}function IBUTinsethArray(b,e,f,a,g){var c=[];for(var d=0;d<b.length;d++){if(b[d]!=undefined){c[d]=IBUTinseth(b[d],e,f,a,g)}}return c}function IBURagerArray(b,e,f,a,g){var c=[];for(var d=0;d<b.length;d++){if(b[d]!=undefined){c[d]=IBURager(b[d],e,f,a,g)}}return c}function IBUTinseth(h,k,d,l,b){var a=new Hops(h.name,h.type,h.aa,h.use,h.useramount,h.time,h.units,h.userutilization,h.usertemp);if(a.use=="Dry Hop"){a.ibu=0;a.utilization=0;return a}var c=parseFloat(a.time);if(isNaN(c)){c=0}if(a.use=="First Wort"){c=20}if(a.use=="Mash"){c=5}if(a.use=="Boil"||a.use=="Aroma"){c=c+l}var e=0;var f=0;if(a.use=="Whirlpool"||a.use=="Hopback"){f=h.userutilization}else{var j=1.65*Math.pow(0.000125,(k-1));var g=(1-Math.pow(BrewingLib.e,(-0.04*c)))/4.15;f=j*g;if(a.type=="Pellet"){f=f*1.1}if(isNumber(b)&&b!=0){f*=b}}e=f*(((a.aa/100)*a.amount*7490)/d);a.utilization=f;a.ibu=e;return a}function IBURager(h,j,e,k,b){var a=new Hops(h.name,h.type,h.aa,h.use,h.useramount,h.time,h.units,h.userutilization,h.usertemp);if(a.use=="Dry Hop"){a.ibu=0;a.utilization=0;return a}var c=parseFloat(a.time);if(isNaN(c)){c=0}if(a.use=="First Wort"){c=20}if(a.use=="Mash"){c=5}if(a.use=="Boil"||a.use=="Aroma"){c=c+k}var f=0;if(j>=1.05){f=(j-1.05)/0.2}var d=0;var g=0;if(a.use=="Whirlpool"||a.use=="Hopback"){g=h.userutilization}else{g=IBURagerUtilization(c);if(isNumber(b)&&b!=0){g*=b}}d=(a.amount*g*(a.aa/100)*7490)/(e*(1+f));a.utilization=g;a.ibu=d;return a}function sinh(a){return(BrewingLib.eToTheX(a)-BrewingLib.eToTheX(-a))/2}function cosh(a){return(BrewingLib.eToTheX(a)+BrewingLib.eToTheX(-a))/2}function hyperbolictangent(a){return sinh(a)/cosh(a)}function IBURagerUtilization(a){if(a<=5){return 0.01*a}return(18.11+(13.86*hyperbolictangent((a-31.32)/18.27)))/100}function calculateStyleMatches(k,j,f,e,l,b){if(k=="-"){k=0}if(j=="-"){j=0}if(f=="-"){f=0}if(e=="-"){e=0}k=parseFloat(k);j=parseFloat(j);f=parseFloat(f);e=parseFloat(e);var c=[];var h=0;var d=l.length;for(i=1;i<d;i++){var a=l[i].oglow;var g=l[i].oghigh;if(b=="plato"){a=convertGravityToPlato(a);g=convertGravityToPlato(g)}if(k>=a&&k<=g&&j>=l[i].abvlow&&j<=l[i].abvhigh&&f>=l[i].ibulow&&f<=l[i].ibuhigh&&e>=l[i].srmlow&&e<=l[i].srmhigh){c[h]=l[i];h++}}return c}function getStyleNamesAsString(c){if(!c){return"-"}var a="";var b=c.length;for(i=0;i<b;i++){if(a!=""){a=a+", "}a=a+c[i].name}if(a==""){a="-"}return a}function computeCaloriesPer12oz(a,e){if(!isNumber(a)){a=0}if(a<=0){return 0}if(!isNumber(e)){e=0}if(e<=-12){return 0}var b=(0.1808*a)+(0.8192*e);var c=(a-b)/(2.0665-(0.010665*a));var d=convertPlatoToGravity(e);var f=((6.9*c)+4*(b-0.1))*d*3.55;return f}function isNumber(b){if(b===null){return false}if(b===0){return true}if(b==""){return false}if(isNaN(b)){return false}var a;for(a=0;a<b.length;a++){var d=b.charAt(a);if(!((d>="0")&&(d<="9"))&&d!="."){return false}}return true}function rounddecimal(e,c){if(e===null){return false}if(e===""){return false}if(isNaN(e)){return false}if(c<0){return false}if(c>10){return false}var a=Math.round(e*Math.pow(10,c))/Math.pow(10,c);var d=(a+"").lastIndexOf(".");if(d==0){a="0"+a;d=1}if(c!=0){d=(a+"").lastIndexOf(".");if(d==-1||d==a.length-1){a+="."}}d=(a+"").lastIndexOf(".");var b=((a+"").length-1)-d;if(b<c){for(x=b;x<c;x++){a+="0"}}return a}function roundClosestFraction(d,b){if(d===null){return false}if(d===""){return false}if(isNaN(d)){return false}var c=Math.ceil(d*b)/b;var a=Math.floor(d*b)/b;if((d-a)>(c-d)){return c}else{return a}}function hasFermentable(b){if(b.length==0){return false}for(var a=0;a<b.length;a++){if(b[a]!=undefined){if(b[a].amount>0&&b[a].ppg>0&&b[a].lovibond>=0){return true}}}return false}function hasHop(a){if(a.length==0){return false}for(var b=0;b<a.length;b++){if(a[b]!=undefined){if(a[b].amount>0&&a[b].aa>0&&((isNumber(a[b].time)&&a[b].time>=0)||a[b].use=="First Wort"||a[b].use=="Mash")){return true}}}return false}function calculateHydrometerCorrection(c,a){c=parseFloat(c);a=parseFloat(a);if(c<0||c>71){return 0}if(a<10||a>24){return 0}var f=[];var h=[];for(var d=0;d<=71;d++){f[d]=d}var e=15-Math.round(a);var g=0;h[0]=-0.0009;h[1]=-0.0009;h[2]=-0.0009;h[3]=-0.0009;h[4]=-0.0009;h[5]=-0.0009;h[6]=-0.0008;h[7]=-0.0008;h[8]=-0.0007;h[9]=-0.0007;h[10]=-0.0006;h[11]=-0.0005;h[12]=-0.0004;h[13]=-0.0003;h[14]=-0.0001;h[15]=0;h[16]=0.0002;h[17]=0.0003;h[18]=0.0005;h[19]=0.0007;h[20]=0.0009;h[21]=0.0011;h[22]=0.0013;h[23]=0.0016;h[24]=0.0018;h[25]=0.0021;h[26]=0.0023;h[27]=0.0026;h[28]=0.0029;h[29]=0.0032;h[30]=0.0035;h[31]=0.0038;h[32]=0.0041;h[33]=0.0044;h[34]=0.0047;h[35]=0.0051;h[36]=0.0054;h[37]=0.0058;h[38]=0.0061;h[39]=0.0065;h[40]=0.0069;h[41]=0.0073;h[42]=0.0077;h[43]=0.0081;h[44]=0.0085;h[45]=0.0089;h[46]=0.0093;h[47]=0.0097;h[48]=0.0102;h[49]=0.0106;h[50]=0.011;h[51]=0.0114;h[52]=0.0118;h[53]=0.0122;h[54]=0.0126;h[55]=0.013;h[56]=0.0135;h[57]=0.014;h[58]=0.0145;h[59]=0.015;h[60]=0.0155;h[61]=0.016;h[62]=0.0165;h[63]=0.0171;h[64]=0.0177;h[65]=0.0183;h[66]=0.0189;h[67]=0.0195;h[68]=0.0201;h[69]=0.0207;h[70]=0.0213;h[71]=0.0219;h[72]=0.0225;h[73]=0.0231;h[74]=0.0237;h[75]=0.0243;h[76]=0.0249;h[77]=0.0255;h[78]=0.0261;h[79]=0.0267;h[80]=0.0273;for(d=0;d<f.length;d++){if(f[d]==c){var b=e;if((d+b)<0){b=0}g=h[d+b];break}if(c>=f[d]&&c<f[d+1]){var b=e;if((d+b)<0){b=0}g=(h[d+b]+h[d+b+1])/2;break}}return g}function litersToGallons(a){a=parseFloat(a);if(isNaN(a)){return false}return 0.264172052*a}function gallonsToLiters(a){a=parseFloat(a);if(isNaN(a)){return false}return 3.78541178*a}function gallonsToQuarts(a){a=parseFloat(a);if(isNaN(a)){return false}return 4*a}function quartsToGallons(a){a=parseFloat(a);if(isNaN(a)){return false}return a/4}function ouncesToGrams(a){a=parseFloat(a);if(isNaN(a)){return false}return 28.3495231*a}function gramsToOunces(a){a=parseFloat(a);if(isNaN(a)){return false}return 0.0352739619*a}function celsiusToFahrenheit(a){a=parseFloat(a);if(a===""){return false}if(isNaN(a)){return false}return(9/5)*a+32}function fahrenheitToCelsius(a){a=parseFloat(a);if(a===""){return false}if(isNaN(a)){return false}return(5/9)*(a-32)}function kilogramsToPounds(a){a=parseFloat(a);if(isNaN(a)){return false}return 2.20462262*a}function poundsToKilograms(a){a=parseFloat(a);if(isNaN(a)){return false}return 0.45359237*a}function litersToQuarts(a){a=parseFloat(a);if(isNaN(a)){return false}return 1.05668821*a}function quartsToLiters(a){a=parseFloat(a);if(isNaN(a)){return false}return 0.946352946*a}function convertAmountToPounds(b,a){if(a=="g"){b=kilogramsToPounds(b/1000)}if(a=="kg"){b=kilogramsToPounds(b)}if(a=="oz"){b=b/16}return b}function convertPlatoToGravity(a){return(a/(258.6-((a/258.2)*227.1)))+1}function convertGravityToPlato(b,c){if(!c){c=1}var a=(-1*616.868)+(1111.14*b)-(630.272*Math.pow(b,2))+(135.997*Math.pow(b,3));return rounddecimal(a,c)}function getFGFromBrix(a,b){return 1-0.0044993*a+0.011774*b+0.00027581*Math.pow(a,2)-0.0012717*Math.pow(b,2)-0.00000728*Math.pow(a,3)+0.000063293*Math.pow(b,3)}function mashThicknessQtLbToLKg(a){a=parseFloat(a);if(isNaN(a)){return false}return 2.0867541*a}function mashThicknessLKgToQtLb(a){a=parseFloat(a);if(isNaN(a)){return false}return a/2.0867541}function reduceTimeUnits(c){var a=c;var b="min.";if(isNaN(c)){}else{if(c%(60*24)==0){a=c/(60*24);b="days"}else{if(c%(60)==0){a=c/(60);b="hr."}}}return[a,b]}function setupBlanks(){addSection("stp");addSection("hops");addSection("other");addSection("mashStep");addSection("fmt");addSection("fmt")}function setupFermentable(b,e){dropdown=document.calc.elements[b];if(!dropdown){return}var d=$("#"+b).val();var f=$("#"+b+" option:selected").text();$("#"+b).children().remove();var a=document.createElement("optgroup");var c="";for(z=0;z<ingredients.length;z++){if(e!="extract"||ingredients[z].category=="Liquid Extract"||ingredients[z].category=="Dry Extract"||ingredients[z].category=="Sugar"||ingredients[z].category=="My Custom Fermentables"||ingredients[z].category==""){if(c!=ingredients[z].category){a=document.createElement("optgroup");a.label=ingredients[z].category;c=ingredients[z].category}var g=document.createElement("option");g.value=ingredients[z].id;g.innerHTML=ingredients[z].name;a.appendChild(g);dropdown.appendChild(a)}}if(d){var h=true;$("#"+b+" option").each(function(){if(this.value==d){h=false;return false}});if(!h){$("#"+b).val(d)}else{alert("Oh no! When switching brewing method, "+f+" was removed from the fermentables list because it has to be mashed. Recommendation - add it as a steeping grain as 5-10% of grain bill if it is not a base malt.")}}$("#"+b).trigger("change")}function setupSteepingGrainDropDown(d){dropdown=document.calc.elements[d];if(!dropdown){return}dropdown.options.length=0;var a=document.createElement("optgroup");var b="";for(z=0;z<ingredients.length;z++){if(ingredients[z].category!="Liquid Extract"&&ingredients[z].category!="Dry Extract"&&ingredients[z].category!="Sugar"){if(b!=ingredients[z].category){a=document.createElement("optgroup");a.label=ingredients[z].category;b=ingredients[z].category}var c=document.createElement("option");c.value=ingredients[z].id;c.innerHTML=ingredients[z].name;a.appendChild(c);dropdown.appendChild(a)}}$("#"+d).trigger("change")}function setupYeastDropDown(b,d){dropdown=yeastdropdown;$("#yeast").empty();var a=document.createElement("optgroup");var c="";var e=yeast;if(b=="id"){e=yeast_by_productid;$("#btn_sortYeastList").html("Sort Yeast List By Name")}else{$("#btn_sortYeastList").html("Sort Yeast List By ID")}for(z=0;z<e.length;z++){if(d==""||e[z].brand=="Default"||e[z].brand==d){if(c!=e[z].brand){a=document.createElement("optgroup");a.label=e[z].brand;if(e[z].brand=="-"){a.label="Others"}c=e[z].brand}var f=document.createElement("option");f.value=e[z].id;f.innerHTML=e[z].name;a.appendChild(f);dropdown.appendChild(a)}}}function toggleYeastSort(){if(defaultYeastSort=="name"){defaultYeastSort="id"}else{defaultYeastSort="name"}var a=getDropDownValue(document.calc,"yeast");setupYeastDropDown(defaultYeastSort,$("#yeastbrand").val());$("#yeast").val(a)}function updateYeastBrand(){var a=getDropDownValue(document.calc,"yeast");setupYeastDropDown(defaultYeastSort,$("#yeastbrand").val());$("#yeast").val(a)}function setupWaterProfileDropDown(){dropdown=document.calc.waterprofile;dropdown.options.length=0;for(z=0;z<waterprofiles.length;z++){var a=document.createElement("option");a.value=waterprofiles[z].name;a.innerHTML=waterprofiles[z].name;dropdown.appendChild(a)}}function setupHopsAutocomplete(){for(i=0;i<maxitems;i++){field=document.calc.elements["hopsVariety"+i];if(field){setupHopAutocomplete("hopsVariety"+i)}}}function setupHopAutocomplete(a){field=$("#"+a);if(field){$(field).autocomplete("destroy");$(field).autocomplete({source:hopsAutoCompleteArray});if(!$(field).data("events").autocompleteselect){$(field).bind("autocompleteselect",function(b,e){var d=e.item;var c="";if(d){c=d.value}lookupHopsAA(b.target.id,c)})}}}function enableButtonsAfterSave(){$(".preview").removeClass("inactive");$(".print").removeClass("inactive");$(".share").removeClass("inactive");$(".copy").removeClass("inactive");$(".waterrequirement").removeClass("inactive");$(".labelgenerator").removeClass("inactive");$(".addtoshoppinglist").removeClass("inactive");$(".brew2nd").removeClass("inactive");$(".brewBannerButton").fadeIn()}function clearFormElement(a){if(a.type=="text"){a.value=""}if(a.type=="select-one"){a.value=""}if(a.type=="checkbox"){a.checked=false}}function loadJSON(d){var b=d.recipe.id;var c=d.recipe;var q=d.steepinggrains;var h=d.fermentables;var k=d.yeasts;var n=d.hops;var C=d.mashsteps;var w=d.others;recipeViewUrl=d.recipe.recipeViewUrl;$("#ddunits").val(c.displayunits);$("#brewmethod").val(c.brewmethod);setupUnits();setupBrewMethod();$("#recipetoken").val(c.recipetoken);$("#txtrecipename").val(c.title);$("#txtauthor").val(c.author);$("#txtbatchsize").val(c.batchsize);$("#txtboilsize").val(c.boilsize);$("#txtboiltime").val(c.boiltime);$("#txtefficiency").val(c.efficiency);$("#mash_thickness").val(c.mash_thickness);$("#primingName").val(c.primingmethod);$("#primingAmount").val(c.primingamount);$("#co2level").val(c.co2level);$("#co2unit").val(c.co2unit);$("#txtnochillextraminutes").val(c.nochillextraminutes);$("#txthop_utilization_factor").val(c.hop_utilization_factor);$("#equipment_profile_id").val(c.equipment_profile_id);$("#notes").val(c.notes);$("#url").val(c.url);if(c.awardwinning!=0){$("#awardwinning").attr("checked","checked")}var f=false;if($('#waterprofile > option[value="'+c.waterprofile+'"]').length!=0){f=true}if(c.waterprofile_custom!=1&&f==true){$("#waterprofile").val(c.waterprofile)}else{if(c.waterprofile){$("#waterprofile").val("Custom");showSection("span_waterprofile_custom");$("#waterprofile_custom").val(c.waterprofile)}}$("#water_ca").val(c.ca2);$("#water_mg").val(c.mg2);$("#water_so").val(c.so4);$("#water_na").val(c.na);$("#water_cl").val(c.cl);$("#water_hco").val(c.hco3);$("#waternotes").val(c.waternotes);var u="";for(i=0;i<bjcp.length;i++){if(bjcp[i].name==c.stylename&&bjcp[i].category==c.stylecategory){u=bjcp[i];break}}if(u==""){for(i=0;i<bjcp.length;i++){if(bjcp[i].name==c.stylename){u=bjcp[i];break}}}if(u){$("#maincategory").val(u.category);updatesubcategory(document.calc.maincategory.selectedIndex);$("#subcategory").val(u.name)}var l=false;for(fermNum in h){if(!h.hasOwnProperty(fermNum)){continue}var m=h[fermNum];if(m.fermentableid!=null){if(m.lateaddition=="1"){l=true}var a=addSection("fmt");if(!(a===false)){$("#fermentableType"+a).val(m.fermentableid);$("#fermentableType"+a).trigger("change");$("#fermentableAmount"+a).val(m.amount);if(m.unit){$("#fmt_units"+a).val(m.unit)}if(m.lateaddition=="1"){$("#fermentableLate"+a).attr("checked","checked");$("#fermentableLateValue"+a).val("true")}}}else{if(m.inventoryid!=null&&getIngredientByID("inventory_"+m.inventoryid)){if(m.lateaddition=="1"){l=true}var a=addSection("fmt");if(!(a===false)){$("#fermentableType"+a).val("inventory_"+m.inventoryid);$("#fermentableAmount"+a).val(m.amount);if(m.unit){$("#fmt_units"+a).val(m.unit)}if(m.lateaddition=="1"){$("#fermentableLate"+a).attr("checked","checked");$("#fermentableLateValue"+a).val("true")}}}else{var t=addSection("cfmt");if(!(t===false)){$("#custfermentableType"+t).val(m.name);$("#custfermentableAmount"+t).val(m.amount);$("#custfermentableColor"+t).val(m.lovibond);$("#custfermentablePPG"+t).val(m.ppg);if(m.unit){$("#custfmt_units"+t).val(m.unit)}if(m.lateaddition=="1"){$("#custfermentableLate"+t).attr("checked","checked");$("#custfermentableLateValue"+t).val("true")}if(m.mashable=="1"){$("#custfermentableMashed"+t).attr("checked","checked");$("#custfermentableMashedValue"+t).val("true")}}}}}for(steepnum in q){if(!q.hasOwnProperty(steepnum)){continue}var B=q[steepnum];if(B.fermentableid!=null){var e=addSection("stp");if(!(e===false)){$("#steepingGrainType"+e).val(B.fermentableid);$("#steepingGrainType"+e).trigger("change");$("#steepingGrainAmount"+e).val(B.amount);if(B.unit){$("#stp_units"+e).val(B.unit)}}}else{if(B.inventoryid!=null&&getIngredientByID("inventory_"+B.inventoryid)){var e=addSection("stp");if(!(e===false)){$("#steepingGrainType"+e).val("inventory_"+B.inventoryid);$("#steepingGrainAmount"+e).val(B.amount);if(B.unit){$("#stp_units"+e).val(B.unit)}}}else{var t=addSection("cfmt");if(!(t===false)){$("#custfermentableType"+t).val(B.name);$("#custfermentableAmount"+t).val(B.amount);$("#custfermentableColor"+t).val(B.lovibond);$("#custfermentablePPG"+t).val(B.ppg);if(B.unit){$("#custfmt_units"+t).val(B.unit)}if(B.mashable=="1"){$("#custfermentableMashed"+t).attr("checked","checked");$("#custfermentableMashedValue"+t).val("true")}}}}}for(hopnum in n){if(!n.hasOwnProperty(hopnum)){continue}var y=n[hopnum];var o=addSection("hops");if(!(o===false)){$("#hopsAmount"+o).val(y.amount);$("#hopsVariety"+o).val(y.name);$("#hopsAA"+o).val(y.aa);$("#hopsTime"+o).val(y.hoptime);$("#hopsType"+o).val(y.hoptype);$("#hopsUse"+o).val(y.hopuse);$("#hopUtilization"+o).val(y.hopstand_utilization);$("#hopStandTemp"+o).val(y.hopstand_temp);if(y.unit){$("#hops_units"+o).val(y.unit)}}}for(othnum in w){if(!w.hasOwnProperty(othnum)){continue}var g=w[othnum];var A=addSection("other");if(!(A===false)){var v=reduceTimeUnits(g.othertime);$("#otherAmount"+A).val(g.amount);$("#otherName"+A).val(g.name);$("#otherTime"+A).val(v[0]);$("#otherTime_units"+A).val(v[1]);$("#otherType"+A).val(g.othertype);$("#otherUse"+A).val(g.otheruse);$("#otherUnit"+A).val(g.unit)}}for(mashnum in C){if(!C.hasOwnProperty(mashnum)){continue}var s=C[mashnum];var j=addSection("mashStep");if(!(j===false)){$("#mashName"+j).val(s.name);$("#mashType"+j).val(s.mashtype);$("#mashAmount"+j).val(s.amount);$("#mashTemp"+j).val(s.temp);$("#mashTime"+j).val(s.mashtime);if(s.unit){$("#mash_units"+j).val(s.unit)}else{$("#mash_units"+j+" option:first").attr("selected","selected")}}}if(C.length==0){addSection("mashStep")}if(q.length==0){addSection("stp")}if(w.length==0){addSection("other")}if(n.length==0){addSection("hops")}var r=k[0];var p=k[1];if(r){$("#yeast").val(r.yeastid);$("#yeastbrand").val(r.laboratory);if(r.custom_attenuation!=0){$("#chk_yeast_custom_attenuation").attr("checked","checked");$("#yeast_custom_attenuation").val(r.attenuation);showSection("span_yeast_attenuation")}}if(c.yeaststarter!=0){$("#yeast_starter").attr("checked","checked")}$("#primary_temp").val(c.primary_temp);$("#pitchrate").val(c.pitchrate);if(p){$("#yeast_custom_name").val(p.name);$("#yeast_custom").attr("checked","checked");showSection("customyeast")}$('input[type="radio"][name="abv_equation"][value="'+c.abvequation+'"]').attr("checked","checked");$('input[type="radio"][name="ibu_equation"][value="'+c.ibuequation+'"]').attr("checked","checked");$('input[type="radio"][name="srm_equation"][value="'+c.srmequation+'"]').attr("checked","checked");$('input[type="radio"][name="sugar_scale"][value="'+c.sugar_scale+'"]').attr("checked","checked");$("#batch_size_mode").val(c.batch_size_mode);if(c["public"]!=0){$("#sharePublic").attr("checked","checked");$("#publicurl").val(c.recipeViewUrl);$("#publicurl").show();upateSharingCheckboxes();if(c.searchable!=0){$("#shareSearchable").attr("checked","checked")}else{$("#shareSearchable").attr("checked",false)}}if(c.snapshot!=0){$(".recipeSnapshotNotice").show()}if(l){openAllMores("fmtall_brewpartitems")}enableButtonsAfterSave();updateAll();jQuery("[name='fermentableType[]']").trigger("change")}function getRecipeAJAX(a){var c="/homebrew/recipe/json/"+a;saveButtonActive(false,{message:"Loading Awesome Recipe..."});var b=$.ajax({url:c,type:"GET",cache:false,timeout:20000,success:function(e){var d=$.parseJSON(e);if(d.message=="success"){loadJSON(d);current_state_saved=true}else{notification("Error: "+d.message,{color:"red"})}setTimeout(function(){saveButtonActive(true,{})},500)},error:function(f,d,e){showPostError(f.responseText);setTimeout(function(){saveButtonActive(true,{})},500);notification("There was an error editing your recipe, please make sure you are connected to the internet and try again.",{color:"red"})}})}var timeReady;jQuery(document).ready(function(a){timeReady=new Date();if(!a.browser.msie){a(window).on("beforeunload",function(c){var b=new Date();if(current_state_saved==false&&b-timeReady>(1000*30)){return"The recipe has unsaved changes and you have been at this page for more than 30 seconds. If you continue, any unsaved changes will be lost."}})}a(":input[id='fermentableType']").each(function(c,b){clearFormElement(b)});a(":input[id='fermentableLate']").each(function(c,b){clearFormElement(b)});a(":input[id='fermentableAmount']").each(function(c,b){clearFormElement(b)});a(":input[id='custfermentableType']").each(function(c,b){clearFormElement(b)});a(":input[id='custfermentableAmount']").each(function(c,b){clearFormElement(b)});a(":input[id='custfermentableColor']").each(function(c,b){clearFormElement(b)});a(":input[id='custfermentablePPG']").each(function(c,b){clearFormElement(b)});a(":input[id='custfermentableLate']").each(function(c,b){clearFormElement(b)});a(":input[id='custfermentableMashed']").each(function(c,b){clearFormElement(b)});a(":input[id='steepingGrainType']").each(function(c,b){clearFormElement(b)});a(":input[id='steepingGrainAmount']").each(function(c,b){clearFormElement(b)});a(":input[id='hopsAmount']").each(function(c,b){clearFormElement(b)});a(":input[id='hopsVariety']").each(function(c,b){clearFormElement(b)});a(":input[id='hopsAA']").each(function(c,b){clearFormElement(b)});a(":input[id='hopsTime']").each(function(c,b){clearFormElement(b)});a(":input[id='hopsType']").each(function(c,b){clearFormElement(b)});a(":input[id='hopsUse']").each(function(c,b){clearFormElement(b)});a(":input[id='otherAmount']").each(function(c,b){clearFormElement(b)});a(":input[id='otherName']").each(function(c,b){clearFormElement(b)});a(":input[id='otherTime']").each(function(c,b){clearFormElement(b)});a(":input[id='otherType']").each(function(c,b){clearFormElement(b)});a(":input[id='otherUse']").each(function(c,b){clearFormElement(b)});a(":input[id='otherUnit']").each(function(c,b){clearFormElement(b)});a(":input[id='mashName']").each(function(c,b){clearFormElement(b)});a(":input[id='mashType']").each(function(c,b){clearFormElement(b)});a(":input[id='mashAmount']").each(function(c,b){clearFormElement(b)});a(":input[id='mashTemp']").each(function(c,b){clearFormElement(b)});a(":input[id='mashTime']").each(function(c,b){clearFormElement(b)});a("#yeast_starter").attr("checked",false);a("#chk_yeast_custom_attenuation").attr("checked",false);a("#yeast_custom").attr("checked",false);a("#yeast_custom_name").val("");a("#yeast_custom_attenuation").val("");a("#txtrecipename").val("");a("#txtauthor").val("");a("#txtboiltime").val("60");a("#notes").val("");a("#url").val("");a("#primingName").val("");a("#primingAmount").val("");a("#waternotes").val("");updateDataArraysWithUserData();a("#maincategory").selectedIndex=0;updatesubcategory(0);setupYeastDropDown(defaultYeastSort,"");setupWaterProfileDropDown();waterProfileUpdate();a('input[id^="fermentableAmount"]').change(function(){updateAll()});a('input[id^="fermentableLate"]').change(function(){updateAll()});a('select[id^="fermentableType"]').change(function(){updateAll()});a('input[id^="custfermentableAmount"]').change(function(){updateAll()});a('input[id^="custfermentableColor"]').change(function(){updateAll()});a('input[id^="custfermentablePPG"]').change(function(){updateAll()});a('input[id^="steepingGrainAmount"]').change(function(){updateAll()});a('select[id^="steepingGrainType"]').change(function(){updateAll()});a('input[id^="hopsAmount"]').change(function(){updateAll()});a('input[id^="hopsAA"]').change(function(){updateAll()});a('input[id^="hopsTime"]').change(function(){updateAll()});a('select[id^="hopsType"]').change(function(){updateAll()});a('select[id^="hopsUse"]').change(function(){updateAll()});a.widget("custom.catcomplete",a.ui.autocomplete,{_renderMenu:function(e,d){var c=this,b="";a.each(d,function(f,g){if(g.category!=b){e.append("<li class='ui-autocomplete-category'>"+g.category+"</li>");b=g.category}c._renderItem(e,g)})}});populateHopsAutocompleteArray();setupHopsAutocomplete();saveButtonActive(true,{});a("input:text:visible:first").focus();a(document).keydown(function(c){if(c.keyCode===8){var b=a(document.activeElement).is("input:[type='text'], input:[type='search'], textarea:focus");if(!b){c.preventDefault()}}});a("#calc").keypress(function(c){if(c.keyCode===13){var b=(a(document.activeElement).is("textarea:focus")||a(document.activeElement).hasClass("ui-autocomplete-input"));if(!b){updateAll();return false}}});a(".preview").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving.")){return}}a(window).unbind("beforeunload");window.location=recipeViewUrl}else{showClickError("Please save your recipe first before previewing.")}});a(".brewBannerButton").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving.")){return}}a(window).unbind("beforeunload");window.location="/homebrew/recipe/brew/"+recipeId}else{showClickError("Please save your recipe first before brewing.")}});a(".brew2nd").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving.")){return}}a(window).unbind("beforeunload");window.location="/homebrew/recipe/brew/"+recipeId}else{showClickError("Please save your recipe first before brewing.")}});a(".print").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving.")){return}}window.open(("/homebrew/recipe/print/"+recipeId),"_blank")}else{showClickError("Please save your recipe first before printing.")}});a(".copy").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving.")){return}}a(window).unbind("beforeunload");window.location="/homebrew/recipe/copy/"+recipeId}else{showClickError("Please save your recipe first before copying.")}});a(".waterrequirement").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving. (Re-saving recommended.)")){return}}showWaterRequirementDialog(recipeId)}else{showClickError("Please save your recipe first before computing water requirements.")}});a(".labelgenerator").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving. (Re-saving recommended.)")){return}}a(window).unbind("beforeunload");window.location="/homebrew/recipe/labelgenerator/"+recipeId}else{showClickError("Please save your recipe first before going to the label generator.")}});a(".addtoshoppinglist").click(function(b){if(recipeId>0){if(current_state_saved==false){if(!confirm("This recipe has been edited since it was last saved. Click okay to proceed without saving.")){return}}a(window).unbind("beforeunload");window.location="/homebrew/recipe/addtoshoppinglist/"+recipeId}else{showClickError("Please save your recipe first before adding to shopping list.")}});a(".share").click(function(b){if(recipeId>0){a("#sharenotification").html("");a("#sharenotification").removeClass("redbackground");a("#sharenotification").removeClass("greenbackground");a("#sharedialog").bind("dialogopen",function(c){disableAllFieldsBehindDialog(this)});a("#sharedialog").bind("dialogclose",function(c){reEnableFieldsBehindDialog()});a("#sharedialog").dialog({modal:true,resizable:false,draggable:false,maxWidth:500,minWidth:500,zIndex:9999,title:("Share "+a("#txtrecipename").val()),buttons:{Apply:function(){doSharingSettings()},Close:function(){a(this).dialog("close")}}})}else{showClickError("Please save your recipe first before sharing.")}});a(".scale").click(function(b){a("#scale_current_batch_size").html(document.calc.txtbatchsize.value);a("#scale_current_efficiency").html(document.calc.txtefficiency.value);a("#newbatchsize").val("");a("#newefficiency").val("");a("#scale_by_efficiency_box").hide();if(a("#brewmethod").val()!="extract"){a("#scale_by_efficiency_box").show()}a("#scaledialog").bind("dialogopen",function(c){disableAllFieldsBehindDialog(this)});a("#scaledialog").bind("dialogclose",function(c){reEnableFieldsBehindDialog()});a("#scaledialog").dialog({modal:true,resizable:false,draggable:false,minWidth:440,maxWidth:440,zIndex:9999,title:("Scale "+a("#txtrecipename").val()),buttons:{Apply:function(){doScaling()},Close:function(){a(this).dialog("close")}}})});a(".togglelarge").each(function(){a(this).click(function(){if(a(this).find(".arrow").hasClass("up")){a(this).find(".arrow").removeClass("up");a(this).find(".arrow").addClass("down");a("#morebutton_ogfg").html("Less...");a(this).parent().find(".maxtoggle").hide();a(this).parent().find(".maxtoggle").slideDown();return false}else{if(a(this).find(".arrow").hasClass("down")){a(this).find(".arrow").removeClass("down");a(this).find(".arrow").addClass("up");a("#morebutton_ogfg").html("More...");a(this).parent().find(".maxtoggle").show();a(this).parent().find(".maxtoggle").slideUp();return false}}})});a("#morebutton_ogfg").click(function(){a("#arrow_ogfg").click()});if(typeof(setRecipeIdForEdit)!="undefined"){setRecipeIdForEdit()}if(recipeId>0){getRecipeAJAX(recipeId)}else{setupBlanks();setupUnits();setupBrewMethod();a("#mash_thickness").val(defaultMashThickness);a(".showOnNewRecipe").show()}enableUpdateAll=true;updateAll();current_state_saved=true});function populateHopsAutocompleteArray(){hopsAutoCompleteArray.length=0;for(z=1;z<hops.length;z++){hopsAutoCompleteArray.push({label:hops[z].name+" ("+hops[z].avgaa+")",value:hops[z].name})}hopsAutoCompleteArray.sort(sortHopsAutoCompleteList)}var recipeId=-1;var recipeViewUrl="";var current_state_saved=false;var recipename="";var author="";var batchsize=5.5;var boilsize=3;var boiltime=60;var efficiency=75;var attenuation=0.75;var units="us";var sugar_scale;var brewmethod="extract";var maxitems=50;var yeastType="dry";var currentIBU;var currentSRM;var og;var fg;var currentABV;var abv_standard;var abv_alternate;var matchesStyle=false;var noChillExtraMinutes=0;var hopUtilizationFactor=1;var fermentableData=[];var hopsData=[];var hopsAutoCompleteArray=[];var yeastdropdown;var subcategorylist;var currentStyle="";var enableUpdateAll=false;function getIngredientByID(a){for(z=0;z<ingredients.length;z++){if(ingredients[z].id==a){return ingredients[z]}}return false}function getYeastByID(a){for(z=0;z<yeast.length;z++){if(yeast[z].id==a){return yeast[z]}}return false}function getHopIndexByVariety(b,a){for(z=0;z<hops.length;z++){if(b[z].name==a){return z}}return -1}function getHopAutoCompleteIndex(a){for(index in hopsAutoCompleteArray){if(hopsAutoCompleteArray[index].value==a){return index}}return -1}function getDropDownValue(b,f){var c="";var e=b.elements[f];try{if(e.selectedIndex!=-1){c=e[e.selectedIndex].value}}catch(a){try{if(e.value!=""){return e.value}}catch(d){alert("Unable to get value for "+f);return""}}return c}function showSection(a){var b=document.getElementById(a);b.style.visibility="visible";b.style.display="block"}function hideSection(a){var b=document.getElementById(a);b.style.visibility="hidden";b.style.display="none"}function getIndexOfBrewPart(b,a){var c=a.replace(b,"");c=parseInt(c);return c}function addSection(g){var d=0;$("#"+g+"_brewpartitems").children().each(function(){var h=getIndexOfBrewPart(g,$(this).attr("id"));if(d<=h){d=h+1}});units=getDropDownValue(document.calc,"ddunits");brewmethod=getDropDownValue(document.calc,"brewmethod");if(d<maxitems){var e=$(("#"+g+"_template")).html();var c=$(e).appendTo(("#"+g+"_brewpartitems")).attr("id",(g+d));if(g=="fmt"){$(c).find("#fmt_units").attr("id",("fmt_units"+d));$(c).find("#fermentableAmount").attr("id",("fermentableAmount"+d));$(c).find("#fmtpercent").attr("id",("fmtpercent"+d));$(c).find("#fmtOGContribution").attr("id",("fmtOGContribution"+d));$(c).find("#fermentableType").attr("id",("fermentableType"+d));$(c).find("#fermentableLate").attr("id",("fermentableLate"+d));$(c).find("#fermentableLateValue").attr("id",("fermentableLateValue"+d));$(c).find("#fmtPPGLabel").attr("id",("fmtPPGLabel"+d));$(c).find("#fmtLovibondLabel").attr("id",("fmtLovibondLabel"+d));$(c).find(".delete").attr("onClick",("javascript: doRemoveFermentable("+d+");"));setupDataItemMoreBar(c,28);setupFermentable(("fermentableType"+d),brewmethod);setupFermentableUnitsDropdown(units,"#fermentableAmount"+d,"#fmt_units"+d);var b=navigator.userAgent;var f=(b.indexOf("Mozilla/5.0")>-1&&b.indexOf("Android ")>-1&&b.indexOf("AppleWebKit")>-1);if(!f&&jQuery.fn.select2!=undefined){$("select#fermentableType"+d).select2();var a=document.documentMode;if(!a||a>11){$("select#fermentableType"+d).next(".select2").find(".select2-selection").focus(function(h){$(this).closest(".select2").prev("select#fermentableType"+d).select2("open")})}}$("select#fermentableType"+d).trigger("change")}else{if(g=="cfmt"){$(c).find("#custfmt_units").attr("id",("custfmt_units"+d));$(c).find("#custfermentableAmount").attr("id",("custfermentableAmount"+d));$(c).find("#custfmtpercent").attr("id",("custfmtpercent"+d));$(c).find("#custfmtOGContribution").attr("id",("custfmtOGContribution"+d));$(c).find("#custfermentableType").attr("id",("custfermentableType"+d));$(c).find("#custfermentableLate").attr("id",("custfermentableLate"+d));$(c).find("#custfermentableLateValue").attr("id",("custfermentableLateValue"+d));$(c).find("#custfermentableColor").attr("id",("custfermentableColor"+d));$(c).find("#custfermentablePPG").attr("id",("custfermentablePPG"+d));$(c).find("#custfermentableMashed").attr("id",("custfermentableMashed"+d));$(c).find("#custfermentableMashedValue").attr("id",("custfermentableMashedValue"+d));$(c).find(".delete").attr("onClick",("javascript: doRemoveCustomFermentable("+d+");"));setupFermentableUnitsDropdown(units,"#custfermentableAmount"+d,"#custfmt_units"+d)}else{if(g=="stp"){$(c).find("#stp_units").attr("id",("stp_units"+d));$(c).find("#steepingGrainAmount").attr("id",("steepingGrainAmount"+d));$(c).find("#steepingGrainType").attr("id",("steepingGrainType"+d));$(c).find("#steeppercent").attr("id",("steeppercent"+d));$(c).find("#stpOGContribution").attr("id",("stpOGContribution"+d));$(c).find("#stpPPGLabel").attr("id",("stpPPGLabel"+d));$(c).find("#stpLovibondLabel").attr("id",("stpLovibondLabel"+d));$(c).find(".delete").attr("onClick",("javascript: doRemoveSteepingGrain("+d+");"));setupDataItemMoreBar(c,28);setupSteepingGrainDropDown(("steepingGrainType"+d));setupFermentableUnitsDropdown(units,"#steepingGrainAmount"+d,"#stp_units"+d);var b=navigator.userAgent;var f=(b.indexOf("Mozilla/5.0")>-1&&b.indexOf("Android ")>-1&&b.indexOf("AppleWebKit")>-1);if(!f&&jQuery.fn.select2!=undefined){$("select#steepingGrainType"+d).select2();var a=document.documentMode;if(!a||a>11){$("select#steepingGrainType"+d).next(".select2").find(".select2-selection").focus(function(h){$(this).closest(".select2").prev("select#steepingGrainType"+d).select2("open")})}}$("select#steepingGrainType"+d).trigger("change")}else{if(g=="hops"){$(c).find("#hops_units").attr("id",("hops_units"+d));$(c).find("#hopsVariety").attr("id",("hopsVariety"+d));$(c).find("#hopsAmount").attr("id",("hopsAmount"+d));$(c).find("#hopsType").attr("id",("hopsType"+d));$(c).find("#hopsTime").attr("id",("hopsTime"+d));$(c).find("#hopsTimeUnitLabel").attr("id",("hopsTimeUnitLabel"+d));$(c).find("#hopsTimeValue").attr("id",("hopsTimeValue"+d));$(c).find("#hopsIBUValue").attr("id",("hopsIBUValue"+d));$(c).find("#hopsUse").attr("id",("hopsUse"+d));$(c).find("#hopsAA").attr("id",("hopsAA"+d));$(c).find("#hopsInfoIBU").attr("id",("hopsInfoIBU"+d));$(c).find("#hopsInfoUtil").attr("id",("hopsInfoUtil"+d));$(c).find("#hopsInfoAAU").attr("id",("hopsInfoAAU"+d));$(c).find("#div_hopstand").attr("id",("div_hopstand"+d));$(c).find("#hopUtilization").attr("id",("hopUtilization"+d));$(c).find("#hopStandTemp").attr("id",("hopStandTemp"+d));$(c).find("#unit_hopstandtemp_").attr("id",("unit_hopstandtemp_"+d));$(c).find(".delete").attr("onClick",("javascript: doRemoveHops("+d+");"));setupHopAutocomplete("hopsVariety"+d);if(units!="metric"){$("#hops_units"+d).val("oz")}else{$("#hops_units"+d).val("g")}}else{if(g=="other"){$(c).find("#unit_otheramt_").attr("id",("unit_otheramt_"+d));$(c).find("#otherAmount").attr("id",("otherAmount"+d));$(c).find("#otherName").attr("id",("otherName"+d));$(c).find("#otherTime").attr("id",("otherTime"+d));$(c).find("#otherTime_units").attr("id",("otherTime_units"+d));$(c).find("#otherType").attr("id",("otherType"+d));$(c).find("#otherUse").attr("id",("otherUse"+d));$(c).find("#otherUnit").attr("id",("otherUnit"+d));$(c).find(".delete").attr("onClick",("javascript: doRemoveOther("+d+");"));setupOtherIngredientsUnitsDropDown(document.calc.elements["otherUnit"+d],units)}else{if(g=="mashStep"){$(c).find("#mashType").attr("id",("mashType"+d));$(c).find("#mashName").attr("id",("mashName"+d));$(c).find("#mashTime").attr("id",("mashTime"+d));$(c).find("#mash_units").attr("id",("mash_units"+d));$(c).find("#mashAmount").attr("id",("mashAmount"+d));$(c).find("#mashTemp").attr("id",("mashTemp"+d));$(c).find("#unit_mashtemp_").attr("id",("unit_mashtemp_"+d));$(c).find(".delete").attr("onClick",("javascript: doRemoveMashStep("+d+");"));setupMashUnitsDropDown(units,"#mashAmount"+d,"#mash_units"+d);if(units!="metric"){$("#mash_units"+d).val(defaultMashUnit)}else{$("#mash_units"+d).val("L")}}}}}}}$(c).find("input, select").not($(".hopsVariety")).change(function(){updateAll()});return d}else{notification("Limit for items reached, cannot add more.",{color:"red"});return false}}function doRemoveFermentable(a){if(a>0){$("#fmt"+a).remove()}else{document.calc.elements["fermentableAmount"+a].value="";document.calc.elements["fermentableType"+a].selectedIndex=0;document.calc.elements["fermentableLate"+a].checked=false;document.calc.elements["fermentableLateValue"+a].value="false";$("#fermentableType"+a).trigger("change")}updateAll()}function doRemoveCustomFermentable(a){$("#cfmt"+a).remove();updateAll()}function doRemoveSteepingGrain(a){if(a>0){$("#stp"+a).remove()}else{if(document.calc.elements["steepingGrainAmount"+a]){document.calc.elements["steepingGrainAmount"+a].value="";document.calc.elements["steepingGrainType"+a].selectedIndex=0}$("#steepingGrainType"+a).trigger("change")}updateAll()}function doRemoveHops(a){if(a>0){$("#hops"+a).remove()}else{document.calc.elements["hopsAmount"+a].value="";document.calc.elements["hopsVariety"+a].value="";document.calc.elements["hopsAA"+a].value="";document.calc.elements["hopsType"+a].selectedIndex=0;document.calc.elements["hopsUse"+a].selectedIndex=0;document.calc.elements["hopsTime"+a].value=""}updateAll()}function doRemoveOther(a){if(a>0){$("#other"+a).remove()}else{document.calc.elements["otherName"+a].value="";document.calc.elements["otherAmount"+a].value="";document.calc.elements["otherTime"+a].value="";document.calc.elements["otherTime_units"+a].value="";document.calc.elements["otherType"+a].selectedIndex=0;document.calc.elements["otherUse"+a].selectedIndex=0;document.calc.elements["otherUnit"+a].selectedIndex=0}updateAll()}function doRemoveMashStep(a){if(a>0){$("#mashStep"+a).remove()}else{document.calc.elements["mashName"+a].value="";document.calc.elements["mashAmount"+a].value="";document.calc.elements["mashTime"+a].value="";document.calc.elements["mashTemp"+a].value="";document.calc.elements["mashType"+a].selectedIndex=0}updateAll()}function waterProfileUpdate(){profilename=getDropDownValue(document.calc,"waterprofile");if(profilename=="Custom"){showSection("span_waterprofile_custom")}else{hideSection("span_waterprofile_custom");document.calc.waterprofile_custom.value=""}if(profilename!="Custom"&&profilename!="--- Water Profile ---"){for(z=0;z<waterprofiles.length;z++){if(waterprofiles[z].name==profilename){$("#water_ca").val(waterprofiles[z].Ca);$("#water_mg").val(waterprofiles[z].Mg);$("#water_so").val(waterprofiles[z].SO4);$("#water_na").val(waterprofiles[z].Na);$("#water_cl").val(waterprofiles[z].Cl);$("#water_hco").val(waterprofiles[z].HCO3)}}}}function toggleCustomYeast(a){if(a.checked==true){showSection("customyeast")}else{hideSection("customyeast");document.calc.yeast_custom_name.value=""}}function toggleCustomAttenuation(a){if(a.checked==true){showSection("span_yeast_attenuation")}else{hideSection("span_yeast_attenuation");document.calc.yeast_custom_attenuation.value="";updateAll()}}function setCurrentStyle(){for(i=0;i<bjcp.length;i++){if(subcategorylist[subcategorylist.selectedIndex].value==bjcp[i].name){currentStyle=bjcp[i];break}}}function updatesubcategory(a){setVars();subcategorylist.options.length=0;if(a==0){for(i=1;i<=34;i++){populateBox(i)}}else{if(a==35){for(i=36;i<=61;i++){populateBox(i)}}else{populateBox(a)}}updateAll()}function populateBox(b){for(z=0;z<subcats[b].length;z++){if(subcats[b][z]!=""){var a=subcats[b][z];var d=subcats_codes[b][z];var c=subcats_letters[b][z];var e="";if(d!=""){e+=d}if(c!=""){e+=c}if(e!=""){a=e+". "+a}subcategorylist.options[subcategorylist.options.length]=new Option(a,subcats[b][z])}}}function setupBrewMethod(){setVars();hideSection("steepinggrains");hideSection("mashsteps");$("#startingMashThickness").hide();$("#efficiency_notes").html("");updateWaterCalcLink();var c=5.5;var b=7.5;if(brewmethod=="allgrain"||brewmethod=="biab"){showSection("mashsteps");if(units=="metric"){c=21;b=28.5}if(brewmethod=="allgrain"){$("#startingMashThickness").show()}}if(brewmethod=="extract"){showSection("steepinggrains");$("#efficiency_notes").html("Steeping Grains Only");b=3;document.calc.txtefficiency.value="35";if(units=="metric"){c=21;b=11}}if(brewmethod=="partialmash"){showSection("mashsteps");b=3;if(units=="metric"){c=21;b=11}}if(brewmethod!="extract"){enableUpdateAll=false;for(i=0;i<=maxitems;i++){doRemoveSteepingGrain(i)}enableUpdateAll=true}for(i=0;i<=maxitems;i++){var a=document.calc.elements["fermentableType"+i];if(a){setupFermentable("fermentableType"+i,brewmethod)}}if(defaultBatchSize!=""){c=defaultBatchSize}if(defaultBoilSize!=""){b=defaultBoilSize}document.calc.txtbatchsize.value=c;document.calc.txtboilsize.value=b;updateAll()}function updateWaterCalcLink(){brewmethod=getDropDownValue(document.calc,"brewmethod");if(brewmethod=="extract"){$(".waterCalcLink").hide();return}if(recipeId>0){$("#water_calc_link_not_saved_yet").hide();var a=$("#water_calc_link_url").html();a+="?recipeId="+recipeId;$("#water_calc_link").attr("href",a);$("#water_calc_link").show();$("#water_calc_link").css("display","block")}else{$("#water_calc_link_not_saved_yet").show();$("#water_calc_link").hide()}}function notification(b,a){$("#message").html("");$("#user_message .closebutton").unbind("click");$("#user_message").attr("class","notice");if(a.color){if(a.color=="red"){$("#user_message").addClass("red")}else{if(a.color=="green"){$("#user_message").addClass("green")}else{if(a.color=="yellow"){$("#user_message").addClass("yellow")}else{if(a.color=="blue"){$("#user_message").addClass("blue")}}}}}$("#user_message .closebutton").click(function(){$("#user_message").slideUp()});$("#user_message").slideDown(function(){$(this).find("#message").html(b)})}function inactiveOverlay(a,b,c){if(c){$(a).css("position","relative");$(a).prepend('<div id="inactiveoverlay"><img src="/homebrew/images/loadhop_75px.gif" /><div>'+b+"</div></div>")}else{if($(a).find("#inactiveoverlay")){$(a).find("#inactiveoverlay").fadeOut().remove()}}}function lookupHopsAA(f,c){var a=0;if(c!=null&&c.length>=3){for(z=1;z<hops.length;z++){if(hops[z].name==c){a=hops[z].avgaa}}}if(a>0){var e=f.replace("Variety","AA");$("#"+e).val(a);var b=f.replace("Variety","Type");var d=f.replace("Variety","Use");if($("#"+b).val()=="--"){$("#"+b).val(defaultHopType)}if($("#"+d).val()=="--"){$("#"+d).val("Boil")}updateAll()}}function sortHops(){setVars();hopsData.sort(sortHopsByOrderTimeName);var a=0;$("#hops_brewpartitems").children().each(function(){var b=getIndexOfBrewPart("hops",$(this).attr("id"));if(hopsData[a]){if(hopsData[a].useramount||hopsData[a].useramount=="0"){$("#hopsAmount"+b).val(hopsData[a].useramount)}else{$("#hopsAmount"+b).val("")}$("#hops_units"+b).val(hopsData[a].units);if(hopsData[a].aa||hopsData[a].aa=="0"){$("#hopsAA"+b).val(hopsData[a].aa)}else{$("#hopsAA"+b).val("")}$("#hopsType"+b).val(hopsData[a].type);$("#hopsUse"+b).val(hopsData[a].use);$("#hopsVariety"+b).val(hopsData[a].name);if(hopsData[a].time||hopsData[a].time=="0"){$("#hopsTime"+b).val(hopsData[a].time)}else{$("#hopsTime"+b).val("")}if(hopsData[a].userutilization||hopsData[a].userutilization=="0"){$("#hopUtilization"+b).val(rounddecimal(hopsData[a].userutilization*100,0))}else{$("#hopUtilization"+b).val("")}if(hopsData[a].usertemp||hopsData[a].usertemp=="0"){$("#hopStandTemp"+b).val(hopsData[a].usertemp)}else{$("#hopStandTemp"+b).val("")}}else{doRemoveHops(b)}a++});updateAll()}function sortHopsByOrderTimeName(b,a){var c=[];c.Mash=1;c["First Wort"]=2;c.Boil=3;c.Aroma=4;c.Whirlpool=5;c.Hopback=6;c["Dry Hop"]=7;hops1UseOrder=c[b.use];hops2UseOrder=c[a.use];if(!hops1UseOrder){hops1UseOrder=99}if(!hops2UseOrder){hops2UseOrder=99}if(hops1UseOrder>hops2UseOrder){return 1}if(hops1UseOrder<hops2UseOrder){return -1}if(hops1UseOrder==hops2UseOrder){if(parseFloat(b.time)<parseFloat(a.time)){return 1}if(parseFloat(b.time)>parseFloat(a.time)){return -1}if(b.time==a.time){if(b.name.toLowerCase()>a.name.toLowerCase()){return 1}else{return -1}}}return 0}function sortOthers(){setVars();var e=[];for(c=0;c<=maxitems;c++){var g=document.calc.elements["otherName"+c];if(g){var a=document.calc.elements["otherName"+c].value;var h=parseFloat(document.calc.elements["otherAmount"+c].value);var k=getDropDownValue(document.calc,"otherUnit"+c);var b=parseFloat(document.calc.elements["otherTime"+c].value);var j=getDropDownValue(document.calc,"otherType"+c);var d=getDropDownValue(document.calc,"otherUse"+c);var f=new Object();f.name=a;f.amount=h;f.units=k;f.time=b;f.type=j;f.use=d;e.push(f)}}e.sort(sortOthersByOrderUseTimeName);var c=0;$("#other_brewpartitems").children().each(function(){var m=getIndexOfBrewPart("other",$(this).attr("id"));if(e[c]){$("#otherName"+m).val(e[c].name);if(e[c].amount||e[c].amount=="0"){$("#otherAmount"+m).val(e[c].amount)}else{$("#otherAmount"+m).val("")}$("#otherUnit"+m).val(e[c].units);if(e[c].time||e[c].time=="0"){var l=reduceTimeUnits(e[c].time);$("#otherTime"+m).val(l[0]);$("#otherTime_units"+m).val(l[1])}else{$("#otherTime"+m).val("");$("#otherTime_units"+m).val("min.")}$("#otherType"+m).val(e[c].type);$("#otherUse"+m).val(e[c].use)}else{doRemoveOther(m)}c++});updateAll()}function sortOthersByOrderUseTimeName(c,b){var a=[];a.Mash=1;a.Boil=2;a.Primary=3;a.Secondary=4;a.Bottling=5;a.Other=6;other1UseOrder=a[c.use];other2UseOrder=a[b.use];if(!other1UseOrder){other1UseOrder=99}if(!other2UseOrder){other2UseOrder=99}if(other1UseOrder>other2UseOrder){return 1}if(other1UseOrder<other2UseOrder){return -1}if(other1UseOrder==other2UseOrder){if(parseFloat(c.time)<parseFloat(b.time)){return 1}if(parseFloat(c.time)>parseFloat(b.time)){return -1}if(c.time==b.time){if(c.name.toLowerCase()>b.name.toLowerCase()){return 1}else{return -1}}}return 0}function sortFermentables(){setVars();fermentableData.sort(sortFermentableData);var c=[];var b=[];for(a=0;a<fermentableData.length;a++){if(fermentableData[a].group=="fermentable"){c.push(fermentableData[a])}if(fermentableData[a].group=="custom"){b.push(fermentableData[a])}}var a=0;$("#fmt_brewpartitems").children().each(function(){var d=getIndexOfBrewPart("fmt",$(this).attr("id"));if(c[a]){if(c[a].useramount||c[a].useramount=="0"){$("#fermentableAmount"+d).val(c[a].useramount)}else{$("#fermentableAmount"+d).val("")}$("#fmt_units"+d).val(c[a].units);$("#fermentableType"+d).val(c[a].id).trigger("change");if(c[a].lateaddition){$("#fermentableLate"+d).attr("checked","checked")}else{$("#fermentableLate"+d).attr("checked",false)}}else{doRemoveFermentable(d)}a++});a=0;$("#cfmt_brewpartitems").children().each(function(){var d=getIndexOfBrewPart("cfmt",$(this).attr("id"));if(b[a]){if(b[a].useramount||b[a].useramount=="0"){$("#custfermentableAmount"+d).val(b[a].useramount)}else{$("#custfermentableAmount"+d).val("")}$("#custfmt_units"+d).val(b[a].units);$("#custfermentableType"+d).val(b[a].name);if(b[a].ppg||b[a].ppg=="0"){$("#custfermentablePPG"+d).val(b[a].ppg)}else{$("#custfermentablePPG"+d).val("")}if(b[a].lovibond||b[a].lovibond=="0"){$("#custfermentableColor"+d).val(b[a].lovibond)}else{$("#custfermentableColor"+d).val("")}if(b[a].lateaddition){$("#custfermentableLate"+d).attr("checked","checked")}else{$("#custfermentableLate"+d).attr("checked",false)}if(b[a].mashable){$("#custfermentableMashed"+d).attr("checked","checked")}else{$("#custfermentableMashed"+d).attr("checked",false)}}else{doRemoveCustomFermentable(d)}a++});updateAll()}function sortFermentableData(b,a){if(b.amount>a.amount){return -1}if(b.amount<a.amount){return 1}if(b.amount==a.amount){if(b.name.toLowerCase()>a.name.toLowerCase()){return 1}else{return -1}}return 0}function sortHopsAutoCompleteList(b,a){if(b.label.toLowerCase()>a.label.toLowerCase()){return 1}if(b.label.toLowerCase()<a.label.toLowerCase()){return -1}return 0}function checkInput(){setVars();if(!isNumber(batchsize)){alert("Batch Size must be a positive number.");return false}if(!isNumber(boilsize)){alert("Boil Size must be a positive number.");return false}if(!isNumber(boiltime)){alert("Boil Time must be a positive number.");return false}if(!isNumber(efficiency)){alert("Efficiency must be a positive number.");return false}if(efficiency<0||efficiency>100){alert("Efficiency should be between 0 and 100.");return false}if(noChillExtraMinutes!=""){if(!isNumber(noChillExtraMinutes)||noChillExtraMinutes<0||noChillExtraMinutes>60){alert("No Chill Extra Minutes should be between 0 and 60, but a normal value is between 5 and 20.");return false}}if(hopUtilizationFactor!=""){if(!isNumber(hopUtilizationFactor)||hopUtilizationFactor<=0||hopUtilizationFactor>5){alert("Hop Utilization Factor should be between 0 and 5 - 1.00 is normal.");return false}}return true}function setVars(){recipename=document.calc.txtrecipename.value;author=document.calc.txtauthor.value;batchsize=document.calc.txtbatchsize.value;boilsize=document.calc.txtboilsize.value;boiltime=document.calc.txtboiltime.value;efficiency=document.calc.txtefficiency.value;units=getDropDownValue(document.calc,"ddunits");sugar_scale=$('input[type="radio"][name="sugar_scale"]:checked').val();brewmethod=getDropDownValue(document.calc,"brewmethod");noChillExtraMinutes=document.calc.txtnochillextraminutes.value;if(noChillExtraMinutes!=""){noChillExtraMinutes=parseInt(noChillExtraMinutes)}hopUtilizationFactor=document.calc.txthop_utilization_factor.value;if(hopUtilizationFactor!=""){hopUtilizationFactor=parseFloat(hopUtilizationFactor)}yeastdropdown=document.calc.elements.yeast;subcategorylist=document.calc.elements.subcategory;fermentableData=[];hopsData=[];mashStepData=[];attenuation=0.75;var t=getDropDownValue(document.calc,"yeast");yeastType="dry";if(t){var a=getYeastByID(t);if(a){attenuation=a.attenuation/100;var w=a.mintemp;var o=a.maxtemp;if(units!="us"){w=rounddecimal(fahrenheitToCelsius(w),1);o=rounddecimal(fahrenheitToCelsius(o),1)}var k=a.alcoholtolerance;if(parseFloat(k)>0){k=parseFloat(k)*100;k=k.toString()+"%"}$("#yeast_stats_temp_min").html(w);$("#yeast_stats_temp_max").html(o);$("#yeast_stats_flocculation").html(a.flocculation);$("#yeast_stats_attenuation").html(a.attenuation);$("#yeast_stats_alcohol_tolerance").html(k);if(a.brand=="Wyeast"||a.brand=="White Labs"){yeastType="liquid"}}}var r=document.calc.yeast_custom_attenuation.value;if(r!=""&&isNumber(r)){r=parseFloat(r);if(r>0&&r<=150){attenuation=(r/100)}}for(i=0;i<=maxitems;i++){var s=document.calc.elements["fermentableAmount"+i];if(s){var v=getDropDownValue(document.calc,"fermentableType"+i);if(v!=""){var H=getIngredientByID(v);var c=false;if(document.calc.elements["fermentableLate"+i]&&document.calc.elements["fermentableLate"+i].checked){c=true;$("#fermentableLateValue"+i).val("true")}else{$("#fermentableLateValue"+i).val("false")}var m=parseFloat(document.calc.elements["fermentableAmount"+i].value);var j=getDropDownValue(document.calc,"fmt_units"+i);if(m>=0){var A=new Fermentable(H.name,H.lovibond,H.ppg,m,H.mashable,H.category,c,v,"fermentable",j,i);fermentableData.push(A)}else{$("#fmtOGContribution"+i).html("")}$("#fmtPPGLabel"+i).html(H.ppg);$("#fmtLovibondLabel"+i).html(H.lovibond)}}}for(i=0;i<=maxitems;i++){var s=document.calc.elements["custfermentableAmount"+i];if(s){var c=false;if(document.calc.elements["custfermentableLate"+i]&&document.calc.elements["custfermentableLate"+i].checked){c=true;$("#custfermentableLateValue"+i).val("true")}else{$("#custfermentableLateValue"+i).val("false")}var e=false;if(document.calc.elements["custfermentableMashed"+i]&&document.calc.elements["custfermentableMashed"+i].checked){e=true;$("#custfermentableMashedValue"+i).val("true")}else{$("#custfermentableMashedValue"+i).val("false")}var m=parseFloat(document.calc.elements["custfermentableAmount"+i].value);var j=getDropDownValue(document.calc,"custfmt_units"+i);var B=parseFloat(document.calc.elements["custfermentableColor"+i].value);var E=parseFloat(document.calc.elements["custfermentablePPG"+i].value);if(m>=0&&B>=0&&E>=0){var A=new Fermentable(document.calc.elements["custfermentableType"+i].value,B,E,m,e,"user supplied",c,-1,"custom",j,i);fermentableData.push(A)}else{$("#custfmtOGContribution"+i).html("")}}}for(i=0;i<=maxitems;i++){var d=document.calc.elements["steepingGrainAmount"+i];if(d){var v=getDropDownValue(document.calc,"steepingGrainType"+i);if(v!=""){var H=getIngredientByID(v);var m=parseFloat(document.calc.elements["steepingGrainAmount"+i].value);var j=getDropDownValue(document.calc,"stp_units"+i);if(m>0){var A=new Fermentable(H.name,H.lovibond,H.ppg,m,H.mashable,H.category,false,v,"steeping",j,i);fermentableData.push(A)}else{$("#stpOGContribution"+i).html("")}}$("#stpPPGLabel"+i).html(H.ppg);$("#stpLovibondLabel"+i).html(H.lovibond)}}for(i=0;i<=maxitems;i++){var G=document.calc.elements["hopsAmount"+i];if(G){var m=parseFloat(document.calc.elements["hopsAmount"+i].value);var u=parseFloat(document.calc.elements["hopsAA"+i].value);var C=parseFloat(document.calc.elements["hopsTime"+i].value);var y=getDropDownValue(document.calc,"hopsType"+i);var n=getDropDownValue(document.calc,"hopsUse"+i);var j=getDropDownValue(document.calc,"hops_units"+i);var F=document.calc.elements["hopsVariety"+i].value;var h=document.calc.elements["hopUtilization"+i].value;var b=document.calc.elements["hopStandTemp"+i].value;if(n=="First Wort"||n=="Mash"){document.calc.elements["hopsTime"+i].value="";C=0;$("#hopsTime"+i).attr("disabled",true)}else{$("#hopsTime"+i).removeAttr("disabled")}if(n=="Dry Hop"){$("#hopsTimeUnitLabel"+i).html("days")}else{$("#hopsTimeUnitLabel"+i).html("min.")}if(n=="Whirlpool"||n=="Hopback"){$("#div_hopstand"+i).show()}else{$("#div_hopstand"+i).hide();$("#hopUtilization"+i).val("");$("#hopStandTemp"+i).val("")}if(u>0&&F!=""){var q=getHopIndexByVariety(hops,F);if(q==-1){hops.push({name:F,avgaa:u})}else{hops[q].avgaa=u}var p=getHopAutoCompleteIndex(F);if(p==-1){hopsAutoCompleteArray.push({label:F+" ("+u+")",value:F})}else{hopsAutoCompleteArray[p].label=F+" ("+u+")"}}document.calc.elements["hopsTimeValue"+i].value=C;hopsData.push(new Hops(F,y,u,n,m,C,j,h,b))}}hopsAutoCompleteArray.sort(sortHopsAutoCompleteList);for(i=0;i<=maxitems;i++){var D=document.calc.elements["mashTemp"+i];if(D){var D=parseFloat(document.calc.elements["mashTemp"+i].value);var l=parseFloat(document.calc.elements["mashTime"+i].value);var m=parseFloat(document.calc.elements["mashAmount"+i].value);var g=getDropDownValue(document.calc,"mashType"+i);if(D>=0){var f=new MashStep(D,l,m,g,units,i);mashStepData.push(f)}}}if(subcategorylist.selectedIndex!=-1){if(currentStyle.name!=subcategorylist[subcategorylist.selectedIndex].value){setCurrentStyle()}}if(units!="us"){batchsize=litersToGallons(batchsize);boilsize=litersToGallons(boilsize)}}function updateAll(){if(enableUpdateAll===false){return}if(brewmethod!="extract"){var m=getDropDownValue(document.calc,"batch_size_mode");if(m=="f"){$("#efficiency_notes").html("(Brew House)")}else{if(m=="k"){$("#efficiency_notes").html("(Ending Kettle)")}}}$("#user_message").slideUp();if(!checkInput()){return false}if(currentStyle!=""){if(sugar_scale=="plato"){$(".ogStyle").html(convertGravityToPlato(currentStyle.oglow)+" - "+convertGravityToPlato(currentStyle.oghigh)+"&deg;P");$(".fgStyle").html(convertGravityToPlato(currentStyle.fglow)+" - "+convertGravityToPlato(currentStyle.fghigh)+"&deg;P")}else{$(".ogStyle").html(currentStyle.oglow+" - "+currentStyle.oghigh);$(".fgStyle").html(currentStyle.fglow+" - "+currentStyle.fghigh)}$(".abvStyle").html(currentStyle.abvlow+" - "+currentStyle.abvhigh+"%");$(".ibuStyleTinseth").html(currentStyle.ibulow+" - "+currentStyle.ibuhigh);$(".ibuStyleRager").html(currentStyle.ibulow+" - "+currentStyle.ibuhigh);$(".srmStyleMorey").html(currentStyle.srmlow+" - "+currentStyle.srmhigh);$(".srmStyleDaniels").html(currentStyle.srmlow+" - "+currentStyle.srmhigh);$(".srmStyleMosher").html(currentStyle.srmlow+" - "+currentStyle.srmhigh);$(".ecbStyle").html(rounddecimal(srmToECB(currentStyle.srmlow),1)+" - "+rounddecimal(srmToECB(currentStyle.srmhigh),1));var V=(currentStyle.srmlow+currentStyle.srmhigh)/2;$(".colorStyle").css("backgroundColor",srm[rounddecimal(V,0)])}else{$(".ogStyle").html("-");$(".fgStyle").html("-");$(".abvStyle").html("-");$(".ibuStyleTinseth").html("-");$(".ibuStyleRager").html("-");$(".srmStyleMorey").html("-");$(".srmStyleDaniels").html("-");$(".srmStyleMosher").html("-");$(".ecbStyle").html("-")}var H=hasFermentable(fermentableData);var g=hasHop(hopsData);var I,l,N;if(H){I=calculateOG(fermentableData,efficiency,batchsize,true);l=calculateOG(fermentableData,efficiency,batchsize,false);if(l==0){l=1}N=calculateBoilGravity(batchsize,boilsize,l);if(I>1.5){I=1.5}if(l>1.5){l=1.5}if(N>1.5){N=1.5}fg=calculateFG(I,attenuation,fermentableData,batchsize,mashStepData);var Q=computeCaloriesPer12oz(convertGravityToPlato(I,10),convertGravityToPlato(fg,10));$(".calories").html(rounddecimal(Q,1));if(sugar_scale=="plato"){$(".boilGravity").html(convertGravityToPlato(N)+" &deg;P");$(".ogBatch").html(convertGravityToPlato(I)+" &deg;P");$("#og").val(convertGravityToPlato(I,10));$("#boilgravity").val(convertGravityToPlato(N));var p=convertGravityToPlato(I);var K=convertGravityToPlato(currentStyle.oglow);var b=convertGravityToPlato(currentStyle.oghigh);if(p>=K&&p<=b){$(".ogBatch").parent().addClass("statsMatchingIndicator");$(".ogBatch").parent().removeClass("statsWarningIndicator")}else{$(".ogBatch").parent().addClass("statsWarningIndicator");$(".ogBatch").parent().removeClass("statsMatchingIndicator")}$(".fgBatch").html(convertGravityToPlato(fg)+" &deg;P");$("#fg").val(convertGravityToPlato(fg,10))}else{$(".boilGravity").html(rounddecimal(N,3));$(".ogBatch").html(rounddecimal(I,3));$("#og").val(rounddecimal(I,3));$("#boilgravity").val(rounddecimal(N,3));var e=rounddecimal(I,3);if(e>=currentStyle.oglow&&e<=currentStyle.oghigh){$(".ogBatch").parent().addClass("statsMatchingIndicator");$(".ogBatch").parent().removeClass("statsWarningIndicator")}else{$(".ogBatch").parent().addClass("statsWarningIndicator");$(".ogBatch").parent().removeClass("statsMatchingIndicator")}$(".fgBatch").html(rounddecimal(fg,3));$("#fg").val(rounddecimal(fg,3))}for(var W=0;W<fermentableData.length;W++){if(fermentableData[W]!=undefined){var k="";if(fermentableData[W].group=="fermentable"){k="fmtOGContribution"}else{if(fermentableData[W].group=="custom"){k="custfmtOGContribution"}else{if(fermentableData[W].group=="steeping"){k="stpOGContribution"}}}k=k+fermentableData[W].domIndex;var J=[];J.push(fermentableData[W]);var X=(calculateOG(J,efficiency,batchsize,true)-1)*1000;if(X<0){X=0}if(X>500){$("#"+k).html("-")}else{if(sugar_scale=="plato"){var y=(X/1000)/(I-1);var S=y*convertGravityToPlato(I,10);$("#"+k).html(rounddecimal(S,1)+" &deg;P")}else{$("#"+k).html(rounddecimal(X,2)+"")}}}}abv_standard=calculateABV(I,fg);abv_alternate=calculateABVAlternate(I,fg);if(abv_standard>100){abv_standard=100}if(abv_alternate>100){abv_alternate=100}$(".abvBatch_standard").html(rounddecimal(abv_standard,2)+"%");if(abv_standard>=currentStyle.abvlow&&abv_standard<=currentStyle.abvhigh){$(".abvBatch_standard").parent().addClass("statsMatchingIndicator");$(".abvBatch_standard").parent().removeClass("statsWarningIndicator")}else{$(".abvBatch_standard").parent().addClass("statsWarningIndicator");$(".abvBatch_standard").parent().removeClass("statsMatchingIndicator")}$(".abvBatch_alternate").html(rounddecimal(abv_alternate,2)+"%");if(abv_alternate>=currentStyle.abvlow&&abv_alternate<=currentStyle.abvhigh){$(".abvBatch_alternate").parent().addClass("statsMatchingIndicator");$(".abvBatch_alternate").parent().removeClass("statsWarningIndicator")}else{$(".abvBatch_alternate").parent().addClass("statsWarningIndicator");$(".abvBatch_alternate").parent().removeClass("statsMatchingIndicator")}var A=calculateSRMMorey(fermentableData,batchsize);var c=calculateSRMDaniels(fermentableData,batchsize);var v=calculateSRMMosher(fermentableData,batchsize);var ab=srmToECB(A);$(".srmBatchMorey").html(rounddecimal(A,2));$(".srmmorey").val(rounddecimal(A,2));$("#srmmorey").val(rounddecimal(A,2));if(A>=currentStyle.srmlow&&A<=currentStyle.srmhigh){$(".srmBatchMorey").parent().addClass("statsMatchingIndicator");$(".srmBatchMorey").parent().removeClass("statsWarningIndicator")}else{$(".srmBatchMorey").parent().addClass("statsWarningIndicator");$(".srmBatchMorey").parent().removeClass("statsMatchingIndicator")}$(".srmBatchDaniels").html(rounddecimal(c,2));$(".srmdaniels").val(rounddecimal(c,2));$("#srmdaniels").val(rounddecimal(c,2));if(c>=currentStyle.srmlow&&c<=currentStyle.srmhigh){$(".srmBatchDaniels").parent().addClass("statsMatchingIndicator");$(".srmBatchDaniels").parent().removeClass("statsWarningIndicator")}else{$(".srmBatchDaniels").parent().addClass("statsWarningIndicator");$(".srmBatchDaniels").parent().removeClass("statsMatchingIndicator")}$(".srmBatchMosher").html(rounddecimal(v,2));$(".srmmosher").val(rounddecimal(v,2));$("#srmmosher").val(rounddecimal(v,2));if(v>=currentStyle.srmlow&&v<=currentStyle.srmhigh){$(".srmBatchMosher").parent().addClass("statsMatchingIndicator");$(".srmBatchMosher").parent().removeClass("statsWarningIndicator")}else{$(".srmBatchMosher").parent().addClass("statsWarningIndicator");$(".srmBatchMosher").parent().removeClass("statsMatchingIndicator")}$(".ecbBatch").html(rounddecimal(ab,2));$(".ecbmorey").val(rounddecimal(ab,2));$("#srmecbmorey").val(rounddecimal(ab,2));if(ab>=srmToECB(currentStyle.srmlow)&&ab<=srmToECB(currentStyle.srmhigh)){$(".ecbBatch").parent().addClass("statsMatchingIndicator");$(".ecbBatch").parent().removeClass("statsWarningIndicator")}else{$(".ecbBatch").parent().addClass("statsWarningIndicator");$(".ecbBatch").parent().removeClass("statsMatchingIndicator")}}else{$(".boilGravity").html("-");$(".ogBatch").html("-");$(".fgBatch").html("-");$(".abvBatch_standard").html("-");$(".abvBatch_alternate").html("-");$(".srmBatchMorey").html("-");$(".srmBatchDaniels").html("-");$(".srmBatchMosher").html("-");$(".ecbBatch").html("-");$(".totalGrainWeight").html("-");$("#og").val(0);$("#fg").val(0);$("#abv").val(0);$("#srmmorey").val(0);$("#srmdaniels").val(0);$("#srmmosher").val(0);$("#srmecbmorey").val(0);$("#boilgravity").val(0);$(".ogBatch").parent().removeClass("statsWarningIndicator");$(".ogBatch").parent().removeClass("statsMatchingIndicator");$(".abvBatch_standard").parent().removeClass("statsWarningIndicator");$(".abvBatch_standard").parent().removeClass("statsMatchingIndicator");$(".abvBatch_alternate").parent().removeClass("statsWarningIndicator");$(".abvBatch_alternate").parent().removeClass("statsMatchingIndicator");$(".srmBatchMorey").parent().removeClass("statsWarningIndicator");$(".srmBatchMorey").parent().removeClass("statsMatchingIndicator");$(".srmBatchDaniels").parent().removeClass("statsWarningIndicator");$(".srmBatchDaniels").parent().removeClass("statsMatchingIndicator");$(".srmBatchMosher").parent().removeClass("statsWarningIndicator");$(".srmBatchMosher").parent().removeClass("statsMatchingIndicator");$(".ecbBatch").parent().removeClass("statsWarningIndicator");$(".ecbBatch").parent().removeClass("statsMatchingIndicator")}if(A>=40){A=40}$(".colorBatch").css("backgroundColor",srm[rounddecimal(A,0)]);if(g==true&&H==true){hopsDataTinseth=IBUTinsethArray(hopsData,N,batchsize,noChillExtraMinutes,hopUtilizationFactor);var B=getIBUTotal(hopsDataTinseth);hopsDataRager=IBURagerArray(hopsData,N,batchsize,noChillExtraMinutes,hopUtilizationFactor);var j=getIBUTotal(hopsDataRager);if(B>0){$(".ibuBatchTinseth").html(rounddecimal(B,2));$("#ibutinseth").val(rounddecimal(B,2));if(B>=currentStyle.ibulow&&B<=currentStyle.ibuhigh){$(".ibuBatchTinseth").parent().addClass("statsMatchingIndicator");$(".ibuBatchTinseth").parent().removeClass("statsWarningIndicator")}else{$(".ibuBatchTinseth").parent().addClass("statsWarningIndicator");$(".ibuBatchTinseth").parent().removeClass("statsMatchingIndicator")}}else{$(".ibuBatchTinseth").html("0");$("#ibutinseth").val(0);$(".ibuBatchTinseth").parent().removeClass("statsWarningIndicator");$(".ibuBatchTinseth").parent().removeClass("statsMatchingIndicator")}if(j>0){$(".ibuBatchRager").html(rounddecimal(j,2));$("#iburager").val(rounddecimal(j,2));if(j>=currentStyle.ibulow&&j<=currentStyle.ibuhigh){$(".ibuBatchRager").parent().addClass("statsMatchingIndicator");$(".ibuBatchRager").parent().removeClass("statsWarningIndicator")}else{$(".ibuBatchRager").parent().addClass("statsWarningIndicator");$(".ibuBatchRager").parent().removeClass("statsMatchingIndicator")}}else{$(".ibuBatchRager").html("0");$("#iburager").val(0);$(".ibuBatchRager").parent().removeClass("statsWarningIndicator");$(".ibuBatchRager").parent().removeClass("statsMatchingIndicator")}var t=$('input[type="radio"][name="ibu_equation"]:checked').val();var D=hopsDataTinseth;if(t=="rager"){D=hopsDataRager}var W=0;$("#hops_brewpartitems").children().each(function(){var ac=getIndexOfBrewPart("hops",$(this).attr("id"));if(D[W].ibu){$("#hopsInfoIBU"+ac).html(rounddecimal(D[W].ibu,2));$("#hopsIBUValue"+ac).val(rounddecimal(D[W].ibu,2))}else{$("#hopsInfoIBU"+ac).html("-");$("#hopsIBUValue"+ac).val("")}if(D[W].utilization){$("#hopsInfoUtil"+ac).html(rounddecimal(D[W].utilization,3))}else{$("#hopsInfoUtil"+ac).html("-")}if(D[W].aau){$("#hopsInfoAAU"+ac).html(rounddecimal(D[W].aau,1))}else{$("#hopsInfoAAU"+ac).html("-")}W++})}else{$(".ibuBatchTinseth").html("-");$(".ibuBatchRager").html("-");$("#ibutinseth").val(0);$("#iburager").val(0)}currentIBU=$('input[type="radio"][name="ibu_equation"]:checked').parent().parent().find(".statsBatch").text();currentSRM=$('input[type="radio"][name="srm_equation"]:checked').parent().parent().find(".statsBatch").text();currentABV=$('input[type="radio"][name="abv_equation"]:checked').parent().parent().find(".statsBatch").text();$(".ibuMin").text(currentIBU);$(".srmMin").text(currentSRM);$(".abvMin").text(currentABV);$("#abv").val(currentABV);currentABV=currentABV.replace("%","");$(".buguRatio").html("-");if(g==true&&H==true&&I>0&&parseFloat(currentIBU)>0){var T=parseFloat(currentIBU)/((I-1)*1000);$(".buguRatio").html(rounddecimal(T,2))}$(".targetResidualAlkalinityLow").html("-");$(".targetResidualAlkalinityHigh").html("-");if(currentSRM!="-"&&currentSRM>0){var G=parseFloat(currentSRM)*12.2-122.4;$(".targetResidualAlkalinityLow").html(rounddecimal(G,2));var d=(parseFloat(currentSRM)-5.2)*12.2;$(".targetResidualAlkalinityHigh").html(rounddecimal(d,2))}var C=getTotalAmount(fermentableData);if(C>0){var Z=C;var R="lb";if(units=="metric"){R="kg";Z=poundsToKilograms(Z)}$("#totalGrainWeight").html(rounddecimal(Z,2)+" "+R);for(W=0;W<=maxitems;W++){var h=document.calc.elements["fermentableAmount"+W];if(h&&h.value>0){var s=getDropDownValue(document.calc,"fmt_units"+W);var F=convertAmountToPounds(h.value,s);$("#fmtpercent"+W).html(rounddecimal((F/C)*100,1)+"%");if($("#fmtpercent"+W).html()=="100.0%"){$("#fmtpercent"+W).html("100%")}}else{$("#fmtpercent"+W).html("%")}}for(W=0;W<=maxitems;W++){var h=document.calc.elements["custfermentableAmount"+W];if(h&&h.value>0){var u=parseFloat(document.calc.elements["custfermentableColor"+W].value);var o=parseFloat(document.calc.elements["custfermentablePPG"+W].value);var s=getDropDownValue(document.calc,"custfmt_units"+W);var F=convertAmountToPounds(h.value,s);if(u>=0&&o>0){$("#custfmtpercent"+W).html(rounddecimal((F/C)*100,1)+"%");if($("#custfmtpercent"+W).html()=="100.0%"){$("#custfmtpercent"+W).html("100%")}}else{$("#custfmtpercent"+W).html("%")}}}for(W=0;W<=maxitems;W++){var h=document.calc.elements["steepingGrainAmount"+W];if(h&&h.value>0){var s=getDropDownValue(document.calc,"stp_units"+W);var F=convertAmountToPounds(h.value,s);$("#steeppercent"+W).html(rounddecimal((F/C)*100,1)+"%");if($("#steeppercent"+W).html()=="100.0%"){$("#steeppercent"+W).html("100%")}}else{$("#steeppercent"+W).html("%")}}}else{$("#totalGrainWeight").html("-")}var P=false;var M=$('input[type="radio"][name="srm_equation"]:checked').val();var w=currentStyle.srmlow;var q=currentStyle.srmhigh;if(M=="ecbmorey"){w=srmToECB(w);q=srmToECB(q)}var n=parseFloat(rounddecimal(I,3));var E=currentStyle.oglow;var O=currentStyle.oghigh;if(sugar_scale=="plato"){n=convertGravityToPlato(I);E=convertGravityToPlato(E);O=convertGravityToPlato(O)}if(n>=E&&n<=O&&currentABV>=currentStyle.abvlow&&currentABV<=currentStyle.abvhigh&&((currentIBU>=currentStyle.ibulow&&currentIBU<=currentStyle.ibuhigh)||(currentIBU=="-"&&currentStyle.ibulow==0&&currentStyle.ibuhigh==0))&&currentSRM>=w&&currentSRM<=q){P=true}else{P=false}if(matchesStyle!=P){if(P){$("#minmatchesstyle .value").css("color","#226d01");$("#minmatchesstyle .value").html('<img src="/homebrew/images/checkmark_light.gif" alt="yes" height="24" />')}else{$("#minmatchesstyle .value").css("color","#000");$("#minmatchesstyle .value").html('<img src="/homebrew/images/checkmark_grey_lght.gif" alt="no" height="24" />')}matchesStyle=P}var a=calculateStyleMatches(n,currentABV,currentIBU,currentSRM,bjcp,sugar_scale);var f=getStyleNamesAsString(a);$("#currentStyleMatch").html(f);var r=$("#pitchrate").val();var U=$("#yeast_calc_link_url").html();U+="?og="+n;U+="&units="+units;U+="&batchsize="+rounddecimal(parseFloat(document.calc.txtbatchsize.value),2);U+="&sugarscale="+sugar_scale;U+="&pitchrate="+r;U+="&yeasttype="+yeastType;$("#yeast_calc_link").attr("href",U);if(r&&batchsize&&n>0){var Y=batchsize*1000;if(units=="us"){Y=gallonsToLiters(batchsize)*1000}var L=n;if(sugar_scale=="sg"){L=convertGravityToPlato(n,10)}var aa=r*Y*L;aa=aa/1000;aa=rounddecimal(aa,0);$("#row_cells_required").show();$("#yeast_stats_cells_required").html(aa+" B")}else{$("#row_cells_required").hide();$("#yeast_stats_cells_required").html("")}setupHopsAutocomplete();current_state_saved=false}function isFunction(a){var b={};return a&&b.toString.call(a)==="[object Function]"}function doPost(b){if($("#txtrecipename").val()==""){$("#txtrecipename").val("Awesome Recipe")}if($("#og").val()=="0"){showPostError("No fermentables have been filled out, please select at least one before saving.");saveButtonActive(true,{});return}saveButtonActive(false,{});var a=$.ajax({url:"/homebrew/save_recipe",type:"POST",data:$("#calc").serialize(),timeout:20000,success:function(d){var c=$.parseJSON(d);if(c.message=="success"){$("#recipetoken").val(c.recipetoken);recipeViewUrl=c.recipeViewUrl;recipeId=c.recipeId;if(!isFunction(b)){notification("Recipe Saved!",{color:"green"});enableButtonsAfterSave()}current_state_saved=true;$(".showOnNewRecipe").hide();updateWaterCalcLink();if(c.useranonymous){document.location="/homebrew/signup/?anonrecipe=1";return}if(isFunction(b)){b(c)}else{setTimeout(function(){saveButtonActive(true,{})},500)}}else{notification("Error: "+c.message,{color:"red"});setTimeout(function(){saveButtonActive(true,{})},500)}},error:function(e,c,d){showPostError(e.responseText);setTimeout(function(){saveButtonActive(true,{})},500);notification("There was an error saving your recipe, please make sure you are connected to the internet and try again.",{color:"red"})}})}function saveButtonActive(c,a){var d="Saving Awesome Recipe...";if(a.message){d=a.message}var b=$(".save");b.unbind("click");if(c){b.text(b.attr("value"));if(b.hasClass("savestate")){b.removeClass("savestate")}inactiveOverlay("#calc",d,false);b.click(doPost)}else{if(!b.hasClass("savestate")){b.addClass("savestate")}inactiveOverlay("#calc",d,true);b.text("Working...")}}function showPostError(a){alert("There was a problem saving the recipe:\n"+a)}function showClickError(a){alert(a)}function convertUnitLabels(b){var c=[];c["lb."]="kg.";c["oz."]="g.";c["qt."]="L";c.F="C";c["(gallons)"]="(liters)";c["qt/oz"]="L/g";var e=[];e["kg."]="lb.";e["g."]="oz.";e.L="qt.";e.C="F";e["(liters)"]="(gallons)";e["L/g"]="qt/oz";var a;if(b=="us"){a=e}else{a=c}var d=document.getElementsByTagName("span");for(i=0;i<d.length;i++){if(d[i].id.indexOf("unit")!=-1){if(d[i].innerHTML in a){d[i].innerHTML=a[d[i].innerHTML]}}}}function setupUnits(){setVars();convertUnitLabels(units);var a=document.calc.elements.txtboilsize;if(units=="us"){a.value=roundClosestFraction(litersToGallons(a.value),10)}else{a.value=roundClosestFraction(gallonsToLiters(a.value),10)}var a=document.calc.elements.txtbatchsize;if(units=="us"){a.value=roundClosestFraction(litersToGallons(a.value),10)}else{a.value=roundClosestFraction(gallonsToLiters(a.value),10)}var j=document.calc.elements.primary_temp;if(j&&j.value!=""){if(units=="us"){j.value=roundClosestFraction(celsiusToFahrenheit(j.value),1)}else{j.value=roundClosestFraction(fahrenheitToCelsius(j.value),1)}}var d=0;for(d=0;d<=maxitems;d++){setupFermentableUnitsDropdown(units,"#fermentableAmount"+d,"#fmt_units"+d);setupFermentableUnitsDropdown(units,"#custfermentableAmount"+d,"#custfmt_units"+d);setupFermentableUnitsDropdown(units,"#steepingGrainAmount"+d,"#stp_units"+d)}for(d=0;d<=maxitems;d++){var b=$("#hops_units"+d).val();var c=$("#hopsAmount"+d).val();if(c!=""){if(b=="g"){$("#hopsAmount"+d).val(roundClosestFraction(gramsToOunces(c),10));$("#hops_units"+d).val("oz")}if(b=="oz"){$("#hopsAmount"+d).val(roundClosestFraction(ouncesToGrams(c),2));$("#hops_units"+d).val("g")}}else{if(units!="metric"){$("#hops_units"+d).val("oz")}else{$("#hops_units"+d).val("g")}}}for(d=0;d<=maxitems;d++){var a=document.calc.elements["otherAmount"+d];var h=document.calc.elements["otherUnit"+d];if(a&&a.value!=""&&h){var f=getDropDownValue(document.calc,"otherUnit"+d);if(units=="us"){if(f=="g"){a.value=roundClosestFraction(gramsToOunces(a.value),10)}if(f=="kg"){a.value=roundClosestFraction(kilogramsToPounds(a.value),20)}if(f=="L"){a.value=roundClosestFraction(litersToQuarts(a.value),10)}if(f=="oz"){a.value=roundClosestFraction(ouncesToGrams(a.value),2)}}else{if(f=="oz"){a.value=roundClosestFraction(ouncesToGrams(a.value),2)}if(f=="lb"){a.value=roundClosestFraction(poundsToKilograms(a.value),50)}if(f=="qt"){a.value=roundClosestFraction(quartsToLiters(a.value),10)}if(f=="g"){a.value=roundClosestFraction(gramsToOunces(a.value),10)}}}var g=0;if(h){var e=h.selectedIndex;setupOtherIngredientsUnitsDropDown(h,units);h.selectedIndex=e}}for(d=0;d<=maxitems;d++){setupMashUnitsDropDown(units,"#mashAmount"+d,"#mash_units"+d)}for(d=0;d<=maxitems;d++){var l=document.calc.elements["mashTemp"+d];if(l&&l.value!=""){if(units=="us"){l.value=roundClosestFraction(celsiusToFahrenheit(l.value),1)}else{l.value=roundClosestFraction(fahrenheitToCelsius(l.value),1)}}}for(d=0;d<=maxitems;d++){var l=document.calc.elements["hopStandTemp"+d];if(l&&l.value!=""){if(units=="us"){l.value=roundClosestFraction(celsiusToFahrenheit(l.value),1)}else{l.value=roundClosestFraction(fahrenheitToCelsius(l.value),1)}}}var k=document.calc.elements.mash_thickness;if(units=="us"){$("#caloriesLabel").html("Calories per 12oz");$(".mash_thickness_unit").html("qt/lb");k.value=roundClosestFraction(mashThicknessLKgToQtLb(k.value),10)}else{$("#caloriesLabel").html("Calories per 355mL");$(".mash_thickness_unit").html("L/kg");k.value=roundClosestFraction(mashThicknessQtLbToLKg(k.value),10)}if(k.value==="0"){k.value=""}setVars();updateAll()}function setupFermentableUnitsDropdown(f,e,d){var c=$(d).val();var b=$(e).val();$(d).empty();if(f=="us"){$(d).append("<option>lb</option>");$(d).append("<option>oz</option>")}else{$(d).append("<option>kg</option>");$(d).append("<option>g</option>")}if(b!=""){if(c=="kg"){$(e).val(roundClosestFraction(kilogramsToPounds(b),20));$(d).val("lb")}if(c=="g"){$(e).val(roundClosestFraction(gramsToOunces(b),10));$(d).val("oz")}if(c=="lb"){var a=poundsToKilograms(b);if(a<0.1){$(e).val(roundClosestFraction(a*1000,10));$(d).val("g")}else{$(e).val(roundClosestFraction(a,20));$(d).val("kg")}}if(c=="oz"){$(e).val(roundClosestFraction(ouncesToGrams(b),1));$(d).val("g")}}}function switchAmountUnit(d,b){var c=$(d).val();var a=$(d).parent().parent().find("input:text");var e=a.val();if(e!=""){if(b=="hops"){if(c=="g"){a.val(roundClosestFraction(ouncesToGrams(e),1))}if(c=="oz"){a.val(roundClosestFraction(gramsToOunces(e),10))}}if(b=="fermentable"){if(c=="g"){a.val(roundClosestFraction(e*1000,1))}if(c=="kg"){a.val(roundClosestFraction(e/1000,100))}if(c=="oz"){a.val(roundClosestFraction(e*16,5))}if(c=="lb"){a.val(roundClosestFraction(e/16,16))}}if(b=="mash"){if(c=="qt"){a.val(roundClosestFraction(gallonsToQuarts(e),10))}if(c=="gal"){a.val(roundClosestFraction(quartsToGallons(e),10))}}}updateAll()}function getOtherIngredientsUnitsArray(a){var b=[];if(a=="us"){b[0]="oz";b[1]="lb";b[2]="qt";b[3]="tsp";b[4]="tbsp";b[5]="each";b[6]="g";b[7]="ml"}else{b[0]="g";b[1]="kg";b[2]="L";b[3]="tsp";b[4]="tbsp";b[5]="each";b[6]="oz";b[7]="ml"}return b}function setupOtherIngredientsUnitsDropDown(c,a){otherUnitsArray=getOtherIngredientsUnitsArray(a);c.options.length=0;for(z=0;z<otherUnitsArray.length;z++){var b=document.createElement("option");b.value=otherUnitsArray[z];b.innerHTML=otherUnitsArray[z];c.appendChild(b)}}function setupMashUnitsDropDown(e,d,c){var b=$(c).val();var a=$(d).val();$(c).empty();if(e=="us"){$(c).append("<option>qt</option>");$(c).append("<option>gal</option>");$(c).val(defaultMashUnit)}else{$(c).append("<option>L</option>")}if(a!=""){if(b=="L"&&defaultMashUnit=="qt"){$(d).val(roundClosestFraction(litersToQuarts(a),10));$(c).val("qt")}if(b=="L"&&defaultMashUnit=="gal"){$(d).val(roundClosestFraction(litersToGallons(a),10));$(c).val("gal")}if(b=="qt"){$(d).val(roundClosestFraction(quartsToLiters(a),10));$(c).val("L")}if(b=="gal"){$(d).val(roundClosestFraction(gallonsToLiters(a),20));$(c).val("L")}}}function setupDataItemMoreBar(b,a){if(!($(b).find(".morebar")===false)){var c=$(b).find(".morebar").get(0);$(c).click(function(){if($(c).val()==="â²"){$(b).css("height",a);$(c).val($("<div/>").text("â¼").html());$(b).find(".moreItems input").attr("disabled",true)}else{$(b).css("height","auto");$(c).val("â²");$(b).find(".moreItems input").removeAttr("disabled")}})}}function openAllMores(a){$("#"+a).find(".dataitem").each(function(b,c){var d=$(c).find(".morebar").get(0);$(c).css("height","auto");$(d).val("â²");$(c).find(".moreItems input").removeAttr("disabled")})}function closeAllMores(a){$("#"+a).find(".dataitem").each(function(b,c){var d=$(c).find(".morebar").get(0);$(c).css("height",28);$(d).val($("<div/>").text("â¼").html());$(c).find(".moreItems input").attr("disabled",true)})}function setupDataItemOnOffButton(b){if(!($(b).find(".onoffbutton")===false)){var a=$(b).find(".onoffbutton input").get(0);$(a).change(function(){if($(a).prop("checked")){$(a).parent().addClass("on");$(a).parent().removeClass("off")}else{$(a).parent().addClass("off");$(a).parent().removeClass("on")}})}}function doScaling(){var c=1;var b=$("#newbatchsize").val();var a=$("#newefficiency").val();if(b!=""&&a!=""){alert("Our apologies, but only one scaling method may be used at a time. Please clear one of the inputs and try again.");return false}if(b==""&&a==""){alert("Our apologies, but no scaling data was provided. Please input a value and try again.");return false}if(b!=""){if(!isNumber(b)){alert("New batch size must be a positive number.");return false}if(b<=0.75){alert("New batch size should be greater than 0.75");return false}}if(a!=""){if(!isNumber(a)){alert("New efficiency must be a positive number.");return false}if(a<1||a>100){alert("New efficiency should be between 1 and 100.");return false}}enableUpdateAll=false;if(b!=""){scaleBatch(b)}if(a!=""){scaleEfficiency(a)}enableUpdateAll=true;updateAll();$("#scaledialog").dialog("close")}function scaleBatch(a){batchsize=document.calc.txtbatchsize.value;boilsize=document.calc.txtboilsize.value;a=parseFloat(a);var b=boilsize-batchsize;scaling_percentage=a/batchsize;batchsize=a;$("#txtbatchsize").val(batchsize);boilsize=parseFloat(batchsize)+parseFloat(b);$("#txtboilsize").val(boilsize);if(boilsize<1){alert("Boil size has been adjusted to match the batch size since it was so low. Please check this and adjust manually.");boilsize=batchsize;$("#txtboilsize").val(boilsize)}applyScalingToGroup("fermentableAmount",scaling_percentage,2);applyScalingToGroup("custfermentableAmount",scaling_percentage,2);applyScalingToGroup("steepingGrainAmount",scaling_percentage,2);applyScalingToGroup("hopsAmount",scaling_percentage,2);applyScalingToGroup("otherAmount",scaling_percentage,2);applyScalingToGroup("mashAmount",scaling_percentage,1)}function scaleEfficiency(h){var j=15;efficiency=document.calc.txtefficiency.value;sugar_scale=$('input[type="radio"][name="sugar_scale"]:checked').val();h=parseFloat(h);scaling_percentage=efficiency/h;efficiency=h;$("#txtefficiency").val(h);var c=parseFloat($("#og").val());applyScalingToGroupMashableOnly("fermentableAmount","fermentableType",j,scaling_percentage,2);applyScalingToGroupMashableOnly("steepingGrainAmount","steepingGrainType",j,scaling_percentage,2);applyScalingToGroupCustom("custfermentableAmount","custfermentableColor","custfermentableMashed",j,scaling_percentage,2);enableUpdateAll=true;updateAll();var f=parseFloat($("#og").val());if(sugar_scale=="plato"){c=rounddecimal(c,1);f=rounddecimal(f,1)}if(f!=c){var k=getLargestFermentableForAdjustment(j);var d=getLargestCustomFermentableForAdjustment(j);var b=null;if(d==null&&k!=null){b=k}if(k==null&&d!=null){b=d}if(k!=null&&d!=null){if(parseFloat(k.value)>parseFloat(d.value)){b=k}else{b=d}}if(b!=null){var a=0.1;if(f>c){a=-0.1}if(sugar_scale=="plato"){a=0.02;if(f>c){a=-0.02}}var g=0;for(g=0;g<=50;g++){b.value=rounddecimal(parseFloat(b.value)+a,2);updateAll();var e=parseFloat($("#og").val());if(sugar_scale=="plato"){e=rounddecimal(e,1)}if(a>0){if(c<=e){break}}else{if(c>=e){break}}}if(g==51){alert("Notice: This scaling operation caused a change in the Original Gravity the calculator could not compensate for. Please adjust amounts of fermentables manually to return the OG to "+c.toString()+".")}}else{alert("Notice: This scaling operation caused a change in the Original Gravity the calculator could not compensate for. A mashable malt with lovibond below "+j+" was not found. Please adjust amounts of fermentables manually to return the OG to "+c.toString()+". This was done to avoid throwing off the flavor / color balance from the dark malts in this recipe.")}}}function applyScalingToGroup(b,e,f){var d=0;for(d=0;d<=maxitems;d++){var a=document.calc.elements[b+d];if(a){var c=parseFloat(document.calc.elements[b+d].value);if(c>0){document.calc.elements[b+d].value=rounddecimal(c*e,f)}}}}function applyScalingToGroupMashableOnly(f,j,b,h,c){var d=0;for(d=0;d<=maxitems;d++){var k=document.calc.elements[f+d];if(k){var e=parseFloat(document.calc.elements[f+d].value);if(e>0){var a=getDropDownValue(document.calc,j+d);if(a!=""){var g=getIngredientByID(a);if(g.mashable&&g.lovibond<=b){document.calc.elements[f+d].value=rounddecimal(e*h,c)}}}}}}function applyScalingToGroupCustom(g,a,h,c,j,d){var e=0;for(e=0;e<=maxitems;e++){var l=document.calc.elements[g+e];if(l){var f=parseFloat(document.calc.elements[g+e].value);var k=parseFloat(document.calc.elements[a+e].value);var b=false;if(document.calc.elements[h+e]&&document.calc.elements[h+e].checked){b=true}if(f>0&&b&&k<=c){document.calc.elements[g+e].value=rounddecimal(f*j,d)}}}}function getLargestFermentableForAdjustment(c){var a=null;var h=null;var g=0;var d=0;for(d=0;d<=maxitems;d++){var j=document.calc.elements["fermentableAmount"+d];if(j){var e=parseFloat(document.calc.elements["fermentableAmount"+d].value);if(e>0){var b=getDropDownValue(document.calc,"fermentableType"+d);if(b!=""){var f=getIngredientByID(b);if(f.mashable&&f.lovibond<=c&&e>g){g=e;h=d}}}}}if(h!=null){a=document.calc.elements["fermentableAmount"+h]}return a}function getLargestCustomFermentableForAdjustment(c){var a=null;var h=null;var g=0;var e=0;for(e=0;e<=maxitems;e++){var k=document.calc.elements["custfermentableAmount"+e];if(k){var f=parseFloat(document.calc.elements["custfermentableAmount"+e].value);if(f>0){var b=document.calc.elements["custfermentableType"+e].value;var d=parseFloat(document.calc.elements["custfermentableColor"+e].value);var j=parseFloat(document.calc.elements["custfermentablePPG"+e].value);if(b!=""&&j>0&&d<=c&&f>g){g=f;h=e}}}}if(h!=null){a=document.calc.elements["custfermentableAmount"+h]}return a}function upateSharingCheckboxes(){if(!$("#sharePublic").is(":checked")){$("#shareSearchable").attr("checked",false);$("#shareSearchable").attr("disabled",true);$("#shareSearchableLabel").css("color","#aaa")}else{$("#shareSearchable").attr("checked","checked");$("#shareSearchable").attr("disabled",false);$("#shareSearchableLabel").css("color","#000")}}var bShareButtonInUse=false;function doSharingSettings(){if(bShareButtonInUse){return}if(recipeId<=0){alert("Recipe must be saved before being shared.");return}bShareButtonInUse=true;$("#sharenotification").removeClass("redbackground");$("#sharenotification").removeClass("greenbackground");$("#sharenotification").html("Saving...");$("body").css("cursor","progress");var a=$.ajax({url:"/homebrew/share_recipe",type:"POST",data:{token:$("#recipetoken").val(),"public":$("#sharePublic").is(":checked"),searchable:$("#shareSearchable").is(":checked")},timeout:20000,success:function(c){var b=$.parseJSON(c);if(b.message=="success"){$("#sharenotification").removeClass("redbackground");$("#sharenotification").addClass("greenbackground");$("#sharenotification").html("Recipe sharing settings updated successfully!");if($("#sharePublic").is(":checked")){$("#publicurl").val(b.recipeViewUrl);$("#publicurl").show("300")}else{$("#publicurl").val("");$("#publicurl").hide()}}else{$("#sharenotification").removeClass("greenbackground");$("#sharenotification").addClass("redbackground");$("#sharenotification").html("Error: "+b.message)}bShareButtonInUse=false;$("body").css("cursor","auto")},error:function(d,b,c){bShareButtonInUse=false;$("body").css("cursor","auto");$("#sharenotification").removeClass("greenbackground");$("#sharenotification").addClass("redbackground");$("#sharenotification").html("There was an error, please make sure you are connected to the internet and try again.")}})};